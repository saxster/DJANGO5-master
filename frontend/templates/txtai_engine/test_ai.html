{% extends 'globals/base.html' %}

{% block title %}AI Functionality Test{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">AI Functionality Test Results</h1>
    
    <div class="row">
        <!-- Model Test Results -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">Model Tests</h5>
                </div>
                <div class="card-body">
                    {% if test_results.models.status == 'success' %}
                        <span class="badge badge-success mb-2">✓ Models Available</span>
                        <ul class="list-unstyled">
                            <li><strong>Semantic Indexes:</strong> {{ test_results.models.semantic_indexes }}</li>
                            <li><strong>Indexed Documents:</strong> {{ test_results.models.indexed_documents }}</li>
                            <li><strong>Knowledge Bases:</strong> {{ test_results.models.knowledge_bases }}</li>
                            <li><strong>Searches:</strong> {{ test_results.models.searches }}</li>
                            <li><strong>RAG Queries:</strong> {{ test_results.models.rag_queries }}</li>
                            <li><strong>Cache Entries:</strong> {{ test_results.models.cache_entries }}</li>
                        </ul>
                    {% else %}
                        <span class="badge badge-danger">✗ Model Error</span>
                        <p class="text-danger mt-2">{{ test_results.models.error }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Service Test Results -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0">Service Tests</h5>
                </div>
                <div class="card-body">
                    {% if test_results.services.status == 'success' %}
                        <span class="badge badge-success mb-2">✓ Services Initialized</span>
                        <ul class="list-unstyled">
                            <li><strong>Search Service:</strong> {{ test_results.services.search_service }}</li>
                            <li><strong>RAG Service:</strong> {{ test_results.services.rag_service }}</li>
                            <li><strong>Indexing Service:</strong> {{ test_results.services.indexing_service }}</li>
                        </ul>
                    {% else %}
                        <span class="badge badge-danger">✗ Service Error</span>
                        <p class="text-danger mt-2">{{ test_results.services.error }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- Search Test Results -->
        <div class="col-md-4 mb-4">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0">Search Tests</h5>
                </div>
                <div class="card-body">
                    {% if test_results.search.status == 'success' %}
                        <span class="badge badge-success mb-2">✓ Search Working</span>
                        <ul class="list-unstyled">
                            <li><strong>Query:</strong> "{{ test_results.search.query }}"</li>
                            <li><strong>Results:</strong> {{ test_results.search.results_count }}</li>
                            <li><strong>Time:</strong> {{ test_results.search.search_time }}ms</li>
                        </ul>
                    {% else %}
                        <span class="badge badge-danger">✗ Search Error</span>
                        <p class="text-danger mt-2">{{ test_results.search.error }}</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    
    <!-- Interactive Test Section -->
    <div class="card mt-4">
        <div class="card-header bg-dark text-white">
            <h5 class="mb-0">Interactive Test</h5>
        </div>
        <div class="card-body">
            <form id="searchTestForm">
                {{ csrf_input }}
                <div class="form-group">
                    <label for="testQuery">Test Search Query:</label>
                    <input type="text" class="form-control" id="testQuery" 
                           placeholder="Enter a test query..." value="maintenance schedule">
                </div>
                <button type="submit" class="btn btn-primary">Test Search</button>
            </form>
            
            <div id="searchResults" class="mt-3" style="display: none;">
                <h6>Search Results:</h6>
                <pre id="resultsContent" class="bg-light p-3"></pre>
            </div>
        </div>
    </div>
    
    <!-- URLs for Testing -->
    <div class="card mt-4">
        <div class="card-header">
            <h5 class="mb-0">Available Test URLs</h5>
        </div>
        <div class="card-body">
            <ul>
                <li><a href="{{ url('txtai_engine:test_ai') }}" class="text-primary">This Test Page</a></li>
                <li><a href="{{ url('txtai_engine:smart_search') }}" class="text-primary">Smart Search Interface</a></li>
                <li><a href="{{ url('txtai_engine:knowledge_base') }}" class="text-primary">Knowledge Base</a></li>
                <li><a href="{{ url('txtai_engine:search_analytics') }}" class="text-primary">Search Analytics</a></li>
                <li><a href="{{ url('txtai_engine:bulk_indexing') }}" class="text-primary">Bulk Indexing</a></li>
            </ul>
            
            <h6 class="mt-3">Management Command:</h6>
            <code class="bg-light p-2 d-block">
                python manage.py test_ai_functionality
            </code>
        </div>
    </div>
</div>

<script>
document.getElementById('searchTestForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const query = document.getElementById('testQuery').value;
    const resultsDiv = document.getElementById('searchResults');
    const resultsContent = document.getElementById('resultsContent');
    
    // Simple test - just show what would be sent
    const testData = {
        query: query,
        timestamp: new Date().toISOString(),
        endpoint: '{{ url("txtai_engine:semantic_search_api") }}',
        method: 'POST'
    };
    
    resultsContent.textContent = JSON.stringify(testData, null, 2);
    resultsDiv.style.display = 'block';
});
</script>
{% endblock %}