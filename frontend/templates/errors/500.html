{% extends "globals/base_accessible.html" %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Server Error" %} (500) - {{ block.super }}{% endblock title %}

{% block extra_css %}
{{ block.super }}
<link href="{{ static('css/design-system.css') }}" rel="stylesheet">
<style>
  .error-page {
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, var(--yt-danger-50) 0%, var(--yt-warning-50) 100%);
    padding: var(--yt-space-4);
  }

  .error-container {
    max-width: 600px;
    width: 100%;
    text-align: center;
    background: var(--yt-bg-surface);
    border-radius: var(--yt-radius-2xl);
    padding: var(--yt-space-8);
    box-shadow: var(--yt-shadow-xl);
  }

  .error-illustration {
    width: 120px;
    height: 120px;
    margin: 0 auto var(--yt-space-6);
    background: var(--yt-danger-100);
    border-radius: var(--yt-radius-full);
    display: flex;
    align-items: center;
    justify-content: center;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.05); }
  }

  .error-icon {
    font-size: 3rem;
    color: var(--yt-danger-600);
  }

  .error-title {
    font-size: var(--yt-text-2xl);
    font-weight: var(--yt-font-semibold);
    color: var(--yt-text-primary);
    margin: 0 0 var(--yt-space-4) 0;
  }

  .error-message {
    font-size: var(--yt-text-base);
    color: var(--yt-text-secondary);
    margin: 0 0 var(--yt-space-6) 0;
    line-height: var(--yt-leading-relaxed);
  }

  .error-actions {
    display: flex;
    gap: var(--yt-space-4);
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: var(--yt-space-6);
  }

  .yt-button {
    display: inline-flex;
    align-items: center;
    gap: var(--yt-space-2);
    padding: var(--yt-space-3) var(--yt-space-6);
    border-radius: var(--yt-radius-lg);
    font-size: var(--yt-text-sm);
    font-weight: var(--yt-font-medium);
    text-decoration: none;
    transition: all var(--yt-duration-200) var(--yt-ease-in-out);
    border: none;
    cursor: pointer;
  }

  .yt-button-primary {
    background: var(--yt-primary-500);
    color: var(--yt-text-inverse);
  }

  .yt-button-primary:hover {
    background: var(--yt-primary-600);
    transform: translateY(-1px);
  }

  .yt-button-secondary {
    background: var(--yt-gray-500);
    color: var(--yt-text-inverse);
  }

  .yt-button-secondary:hover {
    background: var(--yt-gray-600);
  }

  .error-details {
    background: var(--yt-info-50);
    border: var(--yt-border-1) solid var(--yt-info-200);
    border-radius: var(--yt-radius-lg);
    padding: var(--yt-space-4);
    margin-top: var(--yt-space-6);
    text-align: left;
  }

  .error-id {
    font-family: var(--yt-font-mono);
    background: var(--yt-bg-secondary);
    padding: var(--yt-space-1) var(--yt-space-2);
    border-radius: var(--yt-radius-base);
    font-size: var(--yt-text-xs);
  }

  @media (max-width: 640px) {
    .error-actions {
      flex-direction: column;
    }
    .yt-button {
      width: 100%;
      justify-content: center;
    }
  }

  @media (prefers-reduced-motion: reduce) {
    .error-illustration {
      animation: none;
    }
  }
</style>
{% endblock extra_css %}

{% block content %}
<div class="error-page">
  <div class="error-container">

    <!-- Error Illustration -->
    <div class="error-illustration">
      <i class="material-icons error-icon">error</i>
    </div>

    <!-- Error Content -->
    <h1 class="error-title">{% trans "Something Went Wrong" %}</h1>
    <p class="error-message">
      {{ user_message|default:_("We're experiencing technical difficulties. Our team has been automatically notified and is working to fix the issue.") }}
    </p>

    <!-- Action Buttons -->
    <div class="error-actions">
      <button class="yt-button yt-button-primary" onclick="window.location.reload()">
        <i class="material-icons" aria-hidden="true">refresh</i>
        Try Again
      </button>
      <button class="yt-button yt-button-secondary" onclick="history.back()">
        <i class="material-icons" aria-hidden="true">arrow_back</i>
        Go Back
      </button>
      <a href="/" class="yt-button yt-button-secondary">
        <i class="material-icons" aria-hidden="true">home</i>
        Home
      </a>
    </div>

    <!-- Error Details for Support -->
    <div class="error-details">
      <p><strong>{% trans "Error Reference:" %}</strong> <span class="error-id">{{ error_id|default:'N/A' }}</span></p>
      <p><strong>{% trans "Time:" %}</strong> {{ support_context.timestamp|default:'Unknown' }}</p>
      <p><strong>{% trans "Support:" %}</strong> {{ support_context.support_email|default:'support@youtility.com' }}</p>
    </div>

  </div>
</div>

<!-- Screen Reader Announcement -->
<div class="yt-sr-only" aria-live="assertive" aria-atomic="true">
  A server error has occurred. Please try refreshing the page or contact support.
</div>
{% endblock content %}

{% block extra_scripts %}
{{ block.super }}
<script>
// Announce error to screen readers
setTimeout(() => {
  const announcer = document.querySelector('[aria-live="assertive"]');
  if (announcer) {
    announcer.textContent = 'A server error has occurred. Recovery options are available.';
  }
}, 1000);

// Track error for monitoring
console.error('500 Server Error:', {
  errorId: '{{ error_id|default:"unknown" }}',
  timestamp: '{{ support_context.timestamp|default:"unknown" }}',
  path: window.location.pathname
});
</script>
{% endblock extra_scripts %}
