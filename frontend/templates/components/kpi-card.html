{% comment %}
===========================================
  YOUTILITY KPI Card Component
  Industrial Minimal Design System
===========================================

High-impact metric cards for manager dashboards with trend indicators.

USAGE:
  {% include 'components/kpi-card.html' with
    title='Guards On Duty'
    value='247'
    trend='up'
    trend_value='+12%'
    comparison='vs. yesterday'
    icon='people'
    status='success'
  %}

PARAMETERS:
  title (required)       - KPI title/label
  value (required)       - Main metric value (number or string)
  icon (optional)        - Material icon name
  trend (optional)       - Trend direction: 'up'|'down'|'stable'
  trend_value (optional) - Trend percentage/value (e.g., '+12%', '-5')
  comparison (optional)  - Comparison text (e.g., 'vs. yesterday', 'vs. last week')
  status (optional)      - Status color: 'success'|'warning'|'danger'|'info'|'neutral'
                          Default: 'neutral'
  subtitle (optional)    - Additional context below value
  target (optional)      - Target/goal value for comparison
  href (optional)        - Makes card clickable (links to details)
  sparkline (optional)   - Array of numbers for mini chart (future enhancement)
  loading (optional)     - Boolean, shows skeleton state
  class (optional)       - Additional CSS classes

EXAMPLES:

  1. Basic KPI:
     {% include 'components/kpi-card.html' with
       title='Total Sites'
       value='142'
       icon='location_on'
     %}

  2. KPI with trend:
     {% include 'components/kpi-card.html' with
       title='Tours Completed'
       value='89'
       trend='up'
       trend_value='+15%'
       comparison='vs. last week'
       status='success'
     %}

  3. Warning KPI:
     {% include 'components/kpi-card.html' with
       title='Overdue Tours'
       value='7'
       trend='down'
       trend_value='-3'
       comparison='vs. yesterday'
       status='warning'
     %}

  4. Clickable KPI:
     {% include 'components/kpi-card.html' with
       title='Open Tickets'
       value='23'
       href='/helpdesk/tickets/'
       icon='confirmation_number'
     %}

  5. KPI with target:
     {% include 'components/kpi-card.html' with
       title='Attendance Rate'
       value='94%'
       target='95%'
       status='warning'
       subtitle='Below target'
     %}

ACCESSIBILITY:
  - High contrast numbers (easy to scan)
  - ARIA labels for trend indicators
  - Keyboard accessible if clickable
  - Screen reader friendly

{% endcomment %}

{% with
  card_status=status|default:'neutral'
  is_loading=loading|default:False
  is_clickable=href|yesno:'true,false'
  tag=href|yesno:'a,div'
%}

{% with
  base_class='yt-kpi-card'
  status_class='yt-kpi-card--'|add:card_status
  clickable_class=is_clickable|yesno:'yt-kpi-card--clickable,'
  loading_class=is_loading|yesno:'yt-kpi-card--loading,'
  additional_class=class|default:''
  all_classes=base_class|add:' '|add:status_class|add:' '|add:clickable_class|add:loading_class|add:' '|add:additional_class
%}

{% if href %}
  <a href="{{ href }}" class="{{ all_classes }}" role="button">
{% else %}
  <div class="{{ all_classes }}">
{% endif %}

  {# Icon (if provided) #}
  {% if icon and not is_loading %}
    <div class="yt-kpi-card__icon-wrapper">
      <i class="material-icons yt-kpi-card__icon" aria-hidden="true">{{ icon }}</i>
    </div>
  {% endif %}

  {# Content #}
  <div class="yt-kpi-card__content">

    {# Title #}
    <div class="yt-kpi-card__title">{{ title }}</div>

    {# Value with loading skeleton #}
    {% if is_loading %}
      <div class="skeleton skeleton-text" style="width: 80px; height: 36px; margin: var(--space-2) 0;"></div>
    {% else %}
      <div class="yt-kpi-card__value">{{ value }}</div>
    {% endif %}

    {# Subtitle #}
    {% if subtitle %}
      <div class="yt-kpi-card__subtitle">{{ subtitle }}</div>
    {% endif %}

    {# Trend & Comparison #}
    {% if trend and trend_value and not is_loading %}
      <div class="yt-kpi-card__footer">
        <span class="yt-kpi-trend yt-kpi-trend--{{ trend }}" aria-label="Trend {{ trend }}">
          {% if trend == 'up' %}
            <i class="material-icons" aria-hidden="true">arrow_upward</i>
          {% elif trend == 'down' %}
            <i class="material-icons" aria-hidden="true">arrow_downward</i>
          {% else %}
            <i class="material-icons" aria-hidden="true">trending_flat</i>
          {% endif %}
          <span class="yt-kpi-trend__value">{{ trend_value }}</span>
        </span>

        {% if comparison %}
          <span class="yt-kpi-comparison">{{ comparison }}</span>
        {% endif %}
      </div>
    {% endif %}

    {# Target comparison #}
    {% if target and not is_loading %}
      <div class="yt-kpi-target">
        <span class="yt-kpi-target__label">Target:</span>
        <span class="yt-kpi-target__value">{{ target }}</span>
      </div>
    {% endif %}

  </div>

{% if href %}
  </a>
{% else %}
  </div>
{% endif %}

{% endwith %}
{% endwith %}

<style>
/* ========================================
   KPI CARD BASE
   ======================================== */

.yt-kpi-card {
  background: var(--bg-surface);
  border: 1px solid var(--border-default);
  border-radius: var(--radius-md);
  padding: var(--space-5);
  box-shadow: var(--shadow-base);
  transition: all var(--duration-normal) var(--ease-out);
  position: relative;
  overflow: hidden;
  display: flex;
  gap: var(--space-4);
  align-items: flex-start;
}

.yt-kpi-card--clickable {
  cursor: pointer;
  text-decoration: none;
}

.yt-kpi-card--clickable:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
  border-color: var(--border-strong);
}

/* Status variants (left border indicator) */
.yt-kpi-card--success {
  border-left: 4px solid var(--color-success-600);
}

.yt-kpi-card--warning {
  border-left: 4px solid var(--color-warning-600);
}

.yt-kpi-card--danger {
  border-left: 4px solid var(--color-danger-600);
}

.yt-kpi-card--info {
  border-left: 4px solid var(--color-info-600);
}

.yt-kpi-card--neutral {
  border-left: 4px solid var(--color-neutral-300);
}

/* ========================================
   ICON
   ======================================== */

.yt-kpi-card__icon-wrapper {
  width: 56px;
  height: 56px;
  background: var(--bg-muted);
  border-radius: var(--radius-md);
  display: flex;
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.yt-kpi-card__icon {
  font-size: 28px;
  color: var(--text-muted);
}

.yt-kpi-card--success .yt-kpi-card__icon {
  color: var(--color-success-600);
}

.yt-kpi-card--warning .yt-kpi-card__icon {
  color: var(--color-warning-600);
}

.yt-kpi-card--danger .yt-kpi-card__icon {
  color: var(--color-danger-600);
}

.yt-kpi-card--info .yt-kpi-card__icon {
  color: var(--color-info-600);
}

/* ========================================
   CONTENT
   ======================================== */

.yt-kpi-card__content {
  flex: 1;
  min-width: 0;
}

.yt-kpi-card__title {
  font-size: var(--text-sm);
  font-weight: var(--font-medium);
  color: var(--text-secondary);
  margin: 0 0 var(--space-2);
  line-height: var(--leading-normal);
  text-transform: uppercase;
  letter-spacing: var(--tracking-wide);
}

.yt-kpi-card__value {
  font-size: var(--text-4xl);
  font-weight: var(--font-bold);
  color: var(--text-primary);
  line-height: var(--leading-none);
  margin: var(--space-2) 0;
  font-feature-settings: 'tnum';  /* Tabular numbers */
}

.yt-kpi-card__subtitle {
  font-size: var(--text-xs);
  color: var(--text-muted);
  margin-top: var(--space-1);
}

/* ========================================
   TREND INDICATOR
   ======================================== */

.yt-kpi-card__footer {
  display: flex;
  align-items: center;
  gap: var(--space-2);
  margin-top: var(--space-3);
  flex-wrap: wrap;
}

.yt-kpi-trend {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 2px 6px;
  border-radius: var(--radius-base);
  font-size: var(--text-xs);
  font-weight: var(--font-semibold);
  font-family: var(--font-mono);
}

.yt-kpi-trend .material-icons {
  font-size: 14px;
}

/* Trend variants */
.yt-kpi-trend--up {
  background: var(--color-success-100);
  color: var(--color-success-700);
}

.dark .yt-kpi-trend--up {
  background: rgba(34, 197, 94, 0.15);
  color: var(--color-success-600);
}

.yt-kpi-trend--down {
  background: var(--color-danger-100);
  color: var(--color-danger-700);
}

.dark .yt-kpi-trend--down {
  background: rgba(248, 113, 113, 0.15);
  color: var(--color-danger-600);
}

.yt-kpi-trend--stable {
  background: var(--color-neutral-100);
  color: var(--color-neutral-700);
}

.dark .yt-kpi-trend--stable {
  background: rgba(148, 163, 184, 0.15);
  color: var(--color-neutral-400);
}

.yt-kpi-trend__value {
  font-feature-settings: 'tnum';
}

.yt-kpi-comparison {
  font-size: var(--text-xs);
  color: var(--text-muted);
}

/* ========================================
   TARGET
   ======================================== */

.yt-kpi-target {
  margin-top: var(--space-2);
  font-size: var(--text-xs);
  color: var(--text-muted);
}

.yt-kpi-target__label {
  font-weight: var(--font-medium);
}

.yt-kpi-target__value {
  font-weight: var(--font-semibold);
  font-family: var(--font-mono);
  color: var(--text-secondary);
}

/* ========================================
   LOADING STATE
   ======================================== */

.yt-kpi-card--loading {
  pointer-events: none;
}

/* ========================================
   RESPONSIVE
   ======================================== */

@media (max-width: 640px) {
  .yt-kpi-card {
    flex-direction: column;
  }

  .yt-kpi-card__value {
    font-size: var(--text-3xl);
  }
}

/* ========================================
   PRINT
   ======================================== */

@media print {
  .yt-kpi-card {
    border: 1pt solid #000 !important;
    box-shadow: none;
    page-break-inside: avoid;
  }

  .yt-kpi-card--clickable:hover {
    transform: none;
  }
}
</style>
