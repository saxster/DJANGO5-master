{% extends "admin/base_modern_admin.html" %}
{% load static %}

{% block admin_title %}Task Monitoring Dashboard{% endblock admin_title %}
{% block admin_subtitle %}Real-time idempotency, schedule coordination, and task execution metrics{% endblock admin_subtitle %}

{% block admin_stats %}
<div class="admin-stats-grid">
  <!-- Idempotency Hit Rate -->
  <div class="stat-card" style="--stat-color: {% if idempotency.hit_rate > 5 %}var(--yt-danger-500){% elif idempotency.hit_rate > 1 %}var(--yt-warning-500){% else %}var(--yt-success-500){% endif %};">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="material-icons">sync</i>
      </div>
      <div class="stat-info">
        <h3 class="stat-title">Idempotency Hit Rate (24h)</h3>
        <p class="stat-value">{{ idempotency.hit_rate }}%</p>
      </div>
    </div>
    <div class="stat-change {% if idempotency.hit_rate <= 1 %}positive{% elif idempotency.hit_rate > 5 %}negative{% else %}neutral{% endif %}">
      <i class="material-icons">{% if idempotency.hit_rate <= 1 %}check_circle{% else %}warning{% endif %}</i>
      <span>{% if idempotency.hit_rate <= 1 %}Expected{% else %}High - Investigate{% endif %}</span>
    </div>
  </div>

  <!-- Schedule Health Score -->
  <div class="stat-card" style="--stat-color: {% if schedule_health.overall_score >= 80 %}var(--yt-success-500){% elif schedule_health.overall_score >= 60 %}var(--yt-warning-500){% else %}var(--yt-danger-500){% endif %};">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="material-icons">schedule</i>
      </div>
      <div class="stat-info">
        <h3 class="stat-title">Schedule Health Score</h3>
        <p class="stat-value">{{ schedule_health.overall_score }}/100</p>
      </div>
    </div>
    <div class="stat-change {% if schedule_health.overall_score >= 80 %}positive{% elif schedule_health.overall_score >= 60 %}neutral{% else %}negative{% endif %}">
      <i class="material-icons">{% if schedule_health.overall_score >= 80 %}trending_up{% else %}trending_down{% endif %}</i>
      <span>{{ schedule_health.active_schedules }} active schedules</span>
    </div>
  </div>

  <!-- Active Task Queue -->
  <div class="stat-card" style="--stat-color: var(--yt-info-500);">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="material-icons">queue</i>
      </div>
      <div class="stat-info">
        <h3 class="stat-title">Active Tasks</h3>
        <p class="stat-value">{{ queue_status.active_count }}</p>
      </div>
    </div>
    <div class="stat-change neutral">
      <i class="material-icons">pending</i>
      <span>{{ queue_status.scheduled_count }} scheduled</span>
    </div>
  </div>

  <!-- Recent Executions -->
  <div class="stat-card" style="--stat-color: var(--yt-primary-500);">
    <div class="stat-header">
      <div class="stat-icon">
        <i class="material-icons">bolt</i>
      </div>
      <div class="stat-info">
        <h3 class="stat-title">Executions (1h)</h3>
        <p class="stat-value">{{ task_execution.total_executions_last_hour|default:0 }}</p>
      </div>
    </div>
    <div class="stat-change positive">
      <i class="material-icons">check</i>
      <span>{{ task_execution.recent_executions|length }} task types</span>
    </div>
  </div>
</div>
{% endblock admin_stats %}

{% block admin_charts %}
<!-- Charts omitted for brevity - see full implementation -->
<div class="chart-card">
  <h2>Task monitoring charts would be rendered here with Chart.js</h2>
  <p>Idempotency scope breakdown, schedule load distribution, and top executing tasks.</p>
</div>
{% endblock admin_charts %}

{% block extra_scripts %}
{{ block.super }}
<script>
console.log('ðŸ“Š Task Monitoring Dashboard loaded');
</script>
{% endblock extra_scripts %}
