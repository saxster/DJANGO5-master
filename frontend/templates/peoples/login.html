{% extends "peoples/auth_base.html" %}
{% load static %}

{% block title %}Sign in to IntelliWiz{% endblock %}

{% block brand %}
    <img
        src="{{ static('assets/media/logos/youtility_technologies_logo.svg') }}"
        alt="{{ company_name }}"
        class="auth-logo"
        width="184"
        height="184"
        loading="lazy"
    >
    <h1 class="auth-product">{{ product_name }}</h1>
    <p class="auth-tagline">by {{ company_name }}</p>
    <div class="auth-domain-pill" aria-label="Current environment">{{ env_hostname }}</div>
{% endblock %}

{% block content %}
    <div>
        <h2 class="auth-heading">Sign in to {{ product_name }}</h2>
        <p class="auth-subheading">{{ tagline }}</p>
    </div>

    {% if session_expired_message %}
        <div class="auth-banner auth-banner-info" role="status">{{ session_expired_message }}</div>
    {% endif %}

    {% if loginform.non_field_errors %}
        {% for error in loginform.non_field_errors %}
            <div class="auth-alert auth-alert-error" role="alert">{{ error }}</div>
        {% endfor %}
    {% endif %}

    {% if messages %}
        {% for msg in messages %}
            {% if 'alert-danger' in msg.tags %}
                <div class="auth-alert auth-alert-error" role="alert">{{ msg }}</div>
            {% else %}
                <div class="auth-banner auth-banner-info" role="status">{{ msg }}</div>
            {% endif %}
        {% endfor %}
    {% endif %}

    <form method="post" novalidate data-auth-form class="auth-form">
        {% csrf_token %}
        <input type="hidden" name="timezone" id="timezone">

        {% for hidden_field in loginform.hidden_fields %}
            {{ hidden_field }}
        {% endfor %}

        {% for field in loginform.visible_fields %}
            <div class="auth-field">
                <label for="{{ field.id_for_label }}" class="auth-label">{{ field.label }}</label>
                {% if field.help_text %}
                    <p class="auth-help" id="{{ field.id_for_label }}_help">{{ field.help_text }}</p>
                {% endif %}
                {% if field.name == 'password' %}
                    <div class="auth-input-wrapper">
                        {{ field.as_widget(attrs={
                            'data-password-input': 'true',
                            'aria-invalid': field.errors|yesno:'true,false'
                        }) }}
                        <button type="button"
                                class="auth-password-toggle"
                                data-password-toggle
                                aria-label="Show password"
                                aria-pressed="false">
                            <svg data-icon="show" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7z" />
                                <circle cx="12" cy="12" r="3" />
                            </svg>
                            <svg data-icon="hide" hidden xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 19c-7 0-11-7-11-7a18.79 18.79 0 0 1 5.06-5.94" />
                                <path d="M1 1l22 22" />
                            </svg>
                        </button>
                    </div>
                {% else %}
                    {{ field.as_widget(attrs={'aria-invalid': field.errors|yesno:'true,false'}) }}
                {% endif %}
                {% for error in field.errors %}
                    <p class="auth-field-error" role="alert">{{ error }}</p>
                {% endfor %}
            </div>
        {% endfor %}

        <div class="auth-actions">
            <button type="submit" class="auth-button" data-auth-submit>
                <span class="auth-button__spinner" aria-hidden="true"></span>
                <span class="auth-button__label" data-default-label="Sign in" data-loading-label="Signing inâ€¦">Sign in</span>
            </button>
            <div class="auth-links">
                <a href="#" class="auth-link">Forgot password?</a>
                <a href="mailto:{{ support_contact }}" class="auth-link">Need help? Contact your administrator.</a>
            </div>
        </div>
    </form>

    <div class="auth-security-note">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 1l7 4v6c0 5.25-3.438 10.188-7 12-3.562-1.812-7-6.75-7-12V5z" />
            <path d="M9 12l2 2 4-4" />
        </svg>
        <p>Your credentials are encrypted and transmitted securely. Single Sign-On is enabled for supported organizations.</p>
    </div>
{% endblock %}

{% block extra_scripts %}
    {{ block.super }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var tzField = document.getElementById('timezone');
            if (tzField) {
                tzField.value = -new Date().getTimezoneOffset();
            }
        });
    </script>
{% endblock %}
