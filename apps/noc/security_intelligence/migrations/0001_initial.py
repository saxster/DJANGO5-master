# Generated by Django 5.2.7 on 2025-11-09 10:20

import apps.peoples.models.base_model
import django.contrib.gis.db.models.fields
import django.core.validators
import django.db.models.deletion
import django.utils.timezone
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ("attendance", "0001_initial"),
    ]

    operations = [
        migrations.CreateModel(
            name="AuditFinding",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "finding_type",
                    models.CharField(
                        db_index=True,
                        help_text="Type of finding (e.g., 'TOUR_OVERDUE', 'SILENT_SITE', 'SLA_BREACH')",
                        max_length=50,
                    ),
                ),
                (
                    "category",
                    models.CharField(
                        choices=[
                            ("SAFETY", "Safety - Lone worker, panic, patrols"),
                            ("SECURITY", "Security - Geofence, tours, access"),
                            ("OPERATIONAL", "Operational - SLA, tasks, productivity"),
                            ("DEVICE_HEALTH", "Device Health - Offline, GPS, battery"),
                            ("COMPLIANCE", "Compliance - Reports, attendance, legal"),
                        ],
                        db_index=True,
                        help_text="High-level category for classification",
                        max_length=20,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("CRITICAL", "Critical - Immediate action required"),
                            ("HIGH", "High - Action within 2 hours"),
                            ("MEDIUM", "Medium - Action within 24 hours"),
                            ("LOW", "Low - Action within 1 week"),
                        ],
                        db_index=True,
                        help_text="Severity level",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("NEW", "New - Not yet reviewed"),
                            ("ACKNOWLEDGED", "Acknowledged - Under review"),
                            ("IN_PROGRESS", "In Progress - Being remediated"),
                            ("RESOLVED", "Resolved - Issue fixed"),
                            ("FALSE_POSITIVE", "False Positive - Not an issue"),
                            ("SUPPRESSED", "Suppressed - Intentionally ignored"),
                        ],
                        db_index=True,
                        default="NEW",
                        help_text="Current status",
                        max_length=20,
                    ),
                ),
                (
                    "title",
                    models.CharField(
                        help_text="Short title of finding", max_length=200
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description of what was detected"
                    ),
                ),
                (
                    "evidence",
                    models.JSONField(
                        default=dict,
                        help_text="Evidence artifacts with links to source data",
                    ),
                ),
                (
                    "recommended_actions",
                    models.JSONField(
                        default=list, help_text="List of recommended remediation steps"
                    ),
                ),
                (
                    "detected_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        db_index=True,
                        help_text="When finding was detected",
                    ),
                ),
                (
                    "acknowledged_at",
                    models.DateTimeField(
                        blank=True, help_text="When finding was acknowledged", null=True
                    ),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True, help_text="When finding was resolved", null=True
                    ),
                ),
                (
                    "resolution_notes",
                    models.TextField(
                        blank=True, help_text="Notes on how finding was resolved"
                    ),
                ),
                (
                    "time_to_acknowledge",
                    models.DurationField(
                        blank=True,
                        help_text="Time from detection to acknowledgment",
                        null=True,
                    ),
                ),
                (
                    "time_to_resolve",
                    models.DurationField(
                        blank=True,
                        help_text="Time from detection to resolution",
                        null=True,
                    ),
                ),
                (
                    "escalated_to_ticket",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether finding was escalated to a ticket",
                    ),
                ),
                (
                    "escalation_ticket_id",
                    models.IntegerField(
                        blank=True,
                        db_index=True,
                        help_text="ID of ticket created from escalation",
                        null=True,
                    ),
                ),
                (
                    "escalated_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When finding was escalated to ticket",
                        null=True,
                    ),
                ),
                (
                    "evidence_summary",
                    models.TextField(
                        blank=True,
                        help_text="Summarized evidence for dashboard display",
                    ),
                ),
            ],
            options={
                "verbose_name": "Audit Finding",
                "verbose_name_plural": "Audit Findings",
                "db_table": "noc_audit_finding",
                "ordering": ["-detected_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="BaselineProfile",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "metric_type",
                    models.CharField(
                        choices=[
                            (
                                "phone_events",
                                "Phone Events - App/device activity count",
                            ),
                            ("location_updates", "Location Updates - GPS update count"),
                            (
                                "movement_distance",
                                "Movement Distance - Total meters traveled",
                            ),
                            (
                                "tasks_completed",
                                "Tasks Completed - Task completion count",
                            ),
                            (
                                "tour_checkpoints",
                                "Tour Checkpoints - Checkpoint scan count",
                            ),
                            (
                                "staffing_level",
                                "Staffing Level - Number of active guards",
                            ),
                            (
                                "alert_volume",
                                "Alert Volume - Number of alerts generated",
                            ),
                        ],
                        db_index=True,
                        help_text="Type of metric being profiled",
                        max_length=30,
                    ),
                ),
                (
                    "hour_of_week",
                    models.IntegerField(
                        db_index=True,
                        help_text="Hour of week (0-167): Mon 00:00=0, Sun 23:00=167",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(167),
                        ],
                    ),
                ),
                (
                    "mean",
                    models.FloatField(
                        default=0.0,
                        help_text="Mean (average) value for this hour-of-week",
                    ),
                ),
                (
                    "std_dev",
                    models.FloatField(default=0.0, help_text="Standard deviation"),
                ),
                (
                    "min_value",
                    models.FloatField(default=0.0, help_text="Minimum observed value"),
                ),
                (
                    "max_value",
                    models.FloatField(default=0.0, help_text="Maximum observed value"),
                ),
                (
                    "percentiles",
                    models.JSONField(
                        default=dict,
                        help_text="Percentile values (p5, p25, p50, p75, p95, p99)",
                    ),
                ),
                (
                    "sample_count",
                    models.IntegerField(
                        default=0,
                        help_text="Number of samples used to build this baseline",
                    ),
                ),
                (
                    "learning_start_date",
                    models.DateField(
                        blank=True,
                        help_text="When baseline learning started",
                        null=True,
                    ),
                ),
                (
                    "last_updated",
                    models.DateTimeField(
                        auto_now=True, help_text="When baseline was last updated"
                    ),
                ),
                (
                    "is_stable",
                    models.BooleanField(
                        default=False,
                        help_text="Whether baseline is stable (enough samples)",
                    ),
                ),
                (
                    "sensitivity",
                    models.CharField(
                        choices=[
                            ("LOW", "Low - 3+ std devs"),
                            ("MEDIUM", "Medium - 2+ std devs"),
                            ("HIGH", "High - 1.5+ std devs"),
                        ],
                        default="MEDIUM",
                        help_text="Anomaly detection sensitivity",
                        max_length=10,
                    ),
                ),
                (
                    "false_positive_rate",
                    models.FloatField(
                        default=0.0,
                        help_text="Rolling 30-day false positive rate (0.0-1.0)",
                        validators=[
                            django.core.validators.MinValueValidator(0.0),
                            django.core.validators.MaxValueValidator(1.0),
                        ],
                    ),
                ),
                (
                    "dynamic_threshold",
                    models.FloatField(
                        default=3.0,
                        help_text="Dynamically adjusted z-score threshold based on FP rate",
                        validators=[
                            django.core.validators.MinValueValidator(1.5),
                            django.core.validators.MaxValueValidator(5.0),
                        ],
                    ),
                ),
                (
                    "last_threshold_update",
                    models.DateTimeField(
                        blank=True,
                        help_text="When threshold was last updated",
                        null=True,
                    ),
                ),
            ],
            options={
                "verbose_name": "Baseline Profile",
                "verbose_name_plural": "Baseline Profiles",
                "db_table": "noc_baseline_profile",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="BehavioralProfile",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "profile_start_date",
                    models.DateField(help_text="When profiling started"),
                ),
                (
                    "profile_end_date",
                    models.DateField(help_text="Last profile update date"),
                ),
                (
                    "total_observations",
                    models.IntegerField(
                        default=0, help_text="Total attendance events analyzed"
                    ),
                ),
                (
                    "typical_punch_in_hours",
                    models.JSONField(
                        default=list, help_text="List of typical punch-in hours"
                    ),
                ),
                (
                    "typical_punch_out_hours",
                    models.JSONField(
                        default=list, help_text="List of typical punch-out hours"
                    ),
                ),
                (
                    "typical_work_days",
                    models.JSONField(
                        default=list, help_text="Typical work days (0-6, Mon-Sun)"
                    ),
                ),
                (
                    "primary_sites",
                    models.JSONField(
                        default=list,
                        help_text="List of primary site IDs and frequencies",
                    ),
                ),
                (
                    "site_variety_score",
                    models.FloatField(
                        default=0.0, help_text="How many different sites visited (0-1)"
                    ),
                ),
                (
                    "avg_attendance_per_week",
                    models.FloatField(
                        default=0.0, help_text="Average attendance events per week"
                    ),
                ),
                (
                    "punctuality_score",
                    models.FloatField(
                        default=0.0, help_text="On-time arrival score (0-1)"
                    ),
                ),
                (
                    "consistency_score",
                    models.FloatField(
                        default=0.0, help_text="Pattern consistency score (0-1)"
                    ),
                ),
                (
                    "avg_biometric_confidence",
                    models.FloatField(
                        default=0.0, help_text="Average biometric confidence score"
                    ),
                ),
                (
                    "biometric_variance",
                    models.FloatField(
                        default=0.0, help_text="Variance in biometric confidence"
                    ),
                ),
                (
                    "avg_gps_accuracy",
                    models.FloatField(
                        default=0.0, help_text="Average GPS accuracy (meters)"
                    ),
                ),
                (
                    "avg_distance_from_site",
                    models.FloatField(
                        default=0.0,
                        help_text="Average distance from site center (meters)",
                    ),
                ),
                (
                    "avg_tasks_per_shift",
                    models.FloatField(
                        default=0.0, help_text="Average tasks completed per shift"
                    ),
                ),
                (
                    "avg_tours_per_shift",
                    models.FloatField(
                        default=0.0, help_text="Average tours completed per shift"
                    ),
                ),
                (
                    "night_shift_percentage",
                    models.FloatField(
                        default=0.0,
                        help_text="Percentage of shifts that are night shifts",
                    ),
                ),
                (
                    "baseline_fraud_score",
                    models.FloatField(
                        default=0.0, help_text="Baseline fraud risk for this person"
                    ),
                ),
                (
                    "anomaly_detection_threshold",
                    models.FloatField(
                        default=0.3, help_text="Threshold for behavioral anomaly (0-1)"
                    ),
                ),
                (
                    "last_trained_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When ML model was last trained for this profile",
                        null=True,
                    ),
                ),
                (
                    "model_version",
                    models.CharField(
                        default="1.0", help_text="ML model version used", max_length=50
                    ),
                ),
                (
                    "profile_metadata",
                    models.JSONField(default=dict, help_text="Additional profile data"),
                ),
            ],
            options={
                "verbose_name": "Behavioral Profile",
                "verbose_name_plural": "Behavioral Profiles",
                "db_table": "noc_behavioral_profile",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="BiometricVerificationLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "verified_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="Verification timestamp",
                    ),
                ),
                (
                    "verification_type",
                    models.CharField(
                        choices=[
                            ("FACE", "Face Recognition"),
                            ("FINGERPRINT", "Fingerprint"),
                            ("IRIS", "Iris Scan"),
                            ("MULTI", "Multi-factor Biometric"),
                        ],
                        help_text="Type of biometric verification",
                        max_length=20,
                    ),
                ),
                (
                    "result",
                    models.CharField(
                        choices=[
                            ("SUCCESS", "Verified Successfully"),
                            ("FAILED", "Verification Failed"),
                            ("LOW_QUALITY", "Low Quality Image/Scan"),
                            ("SUSPICIOUS", "Suspicious Pattern"),
                            ("FRAUD_DETECTED", "Fraud Detected"),
                        ],
                        db_index=True,
                        help_text="Verification result",
                        max_length=20,
                    ),
                ),
                (
                    "confidence_score",
                    models.FloatField(help_text="Biometric match confidence (0-1)"),
                ),
                (
                    "quality_score",
                    models.FloatField(
                        blank=True,
                        help_text="Image/scan quality score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "device_id",
                    models.CharField(
                        db_index=True,
                        help_text="Device used for verification",
                        max_length=100,
                    ),
                ),
                (
                    "is_concurrent",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Concurrent verification detected",
                    ),
                ),
                (
                    "concurrent_sites",
                    models.JSONField(
                        default=list,
                        help_text="Other sites with concurrent verification",
                    ),
                ),
                (
                    "is_suspicious_pattern",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Suspicious timing pattern detected",
                    ),
                ),
                (
                    "pattern_indicators",
                    models.JSONField(
                        default=list, help_text="List of suspicious pattern indicators"
                    ),
                ),
                (
                    "fraud_score",
                    models.FloatField(
                        default=0.0, help_text="Overall fraud probability (0-1)"
                    ),
                ),
                (
                    "face_embedding_id",
                    models.IntegerField(
                        blank=True, help_text="ID of face embedding used", null=True
                    ),
                ),
                (
                    "liveness_score",
                    models.FloatField(
                        blank=True,
                        help_text="Liveness detection score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "verification_metadata",
                    models.JSONField(
                        default=dict, help_text="Additional verification details"
                    ),
                ),
                (
                    "flagged_for_review",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flagged for manual review",
                    ),
                ),
                (
                    "reviewed_at",
                    models.DateTimeField(
                        blank=True, help_text="Review timestamp", null=True
                    ),
                ),
                (
                    "review_notes",
                    models.TextField(blank=True, help_text="Review findings"),
                ),
            ],
            options={
                "verbose_name": "Biometric Verification Log",
                "verbose_name_plural": "Biometric Verification Logs",
                "db_table": "noc_biometric_verification_log",
                "ordering": ["-verified_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="FindingRunbook",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "finding_type",
                    models.CharField(
                        db_index=True,
                        help_text="Finding type this runbook applies to (e.g., 'TOUR_OVERDUE')",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "title",
                    models.CharField(help_text="Human-readable title", max_length=200),
                ),
                (
                    "category",
                    models.CharField(
                        choices=[
                            ("SAFETY", "Safety"),
                            ("SECURITY", "Security"),
                            ("OPERATIONAL", "Operational"),
                            ("DEVICE_HEALTH", "Device Health"),
                            ("COMPLIANCE", "Compliance"),
                        ],
                        db_index=True,
                        help_text="Finding category",
                        max_length=20,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("CRITICAL", "Critical"),
                            ("HIGH", "High"),
                            ("MEDIUM", "Medium"),
                            ("LOW", "Low"),
                        ],
                        help_text="Default severity for this finding type",
                        max_length=20,
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description of what this finding indicates"
                    ),
                ),
                (
                    "evidence_required",
                    models.JSONField(
                        default=list,
                        help_text="List of evidence types required: ['tour_log', 'location_history', 'guard_status']",
                    ),
                ),
                (
                    "steps",
                    models.JSONField(
                        default=list, help_text="Ordered list of remediation steps"
                    ),
                ),
                (
                    "escalation_sla_minutes",
                    models.IntegerField(
                        default=15,
                        help_text="Minutes before escalation if not resolved",
                    ),
                ),
                (
                    "escalate_to_role",
                    models.CharField(
                        default="supervisor",
                        help_text="Role to escalate to (supervisor, manager, noc_lead)",
                        max_length=50,
                    ),
                ),
                (
                    "auto_actions",
                    models.JSONField(
                        default=list,
                        help_text="List of auto-actions: ['send_sms', 'create_ticket', 'escalate']",
                    ),
                ),
                (
                    "auto_action_enabled",
                    models.BooleanField(
                        default=False, help_text="Whether auto-actions are enabled"
                    ),
                ),
                (
                    "documentation_url",
                    models.URLField(
                        blank=True, help_text="Link to detailed documentation or wiki"
                    ),
                ),
                (
                    "usage_count",
                    models.IntegerField(
                        default=0,
                        help_text="Number of times this runbook has been applied",
                    ),
                ),
                (
                    "avg_resolution_time_minutes",
                    models.FloatField(
                        default=0.0,
                        help_text="Average time to resolve using this runbook",
                    ),
                ),
                (
                    "success_rate",
                    models.FloatField(
                        default=0.0,
                        help_text="Percentage of findings resolved successfully (0-100)",
                    ),
                ),
            ],
            options={
                "verbose_name": "Finding Runbook",
                "verbose_name_plural": "Finding Runbooks",
                "db_table": "noc_finding_runbook",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="FraudDetectionModel",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "model_version",
                    models.CharField(
                        db_index=True,
                        help_text="Model version identifier (e.g., 'v1_20251102_143000')",
                        max_length=50,
                    ),
                ),
                (
                    "model_path",
                    models.CharField(
                        help_text="Path to saved model file (.joblib)", max_length=500
                    ),
                ),
                (
                    "pr_auc",
                    models.FloatField(help_text="Precision-Recall AUC (target: >0.70)"),
                ),
                (
                    "precision_at_80_recall",
                    models.FloatField(
                        help_text="Precision at 80% recall (target: >0.50)"
                    ),
                ),
                (
                    "optimal_threshold",
                    models.FloatField(
                        default=0.5,
                        help_text="Optimal decision threshold for classification",
                    ),
                ),
                (
                    "train_samples",
                    models.IntegerField(help_text="Number of training samples"),
                ),
                (
                    "fraud_samples",
                    models.IntegerField(
                        default=0, help_text="Number of fraud samples in training set"
                    ),
                ),
                (
                    "normal_samples",
                    models.IntegerField(
                        default=0, help_text="Number of normal samples in training set"
                    ),
                ),
                (
                    "class_imbalance_ratio",
                    models.FloatField(
                        default=0.0,
                        help_text="Fraud samples / Total samples (e.g., 0.01 = 1% fraud)",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether this model is active for predictions",
                    ),
                ),
                (
                    "activated_at",
                    models.DateTimeField(
                        blank=True, help_text="When model was activated", null=True
                    ),
                ),
                (
                    "deactivated_at",
                    models.DateTimeField(
                        blank=True, help_text="When model was deactivated", null=True
                    ),
                ),
                (
                    "metadata",
                    models.JSONField(
                        default=dict,
                        help_text="Additional model metadata (feature importance, hyperparameters, etc.)",
                    ),
                ),
                (
                    "training_duration_seconds",
                    models.IntegerField(
                        blank=True, help_text="Training duration in seconds", null=True
                    ),
                ),
                (
                    "xgboost_params",
                    models.JSONField(
                        default=dict, help_text="XGBoost hyperparameters used"
                    ),
                ),
                (
                    "feature_importance",
                    models.JSONField(
                        default=dict, help_text="Feature importance scores"
                    ),
                ),
            ],
            options={
                "verbose_name": "Fraud Detection Model",
                "verbose_name_plural": "Fraud Detection Models",
                "db_table": "noc_fraud_detection_model",
                "ordering": ["-cdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="FraudPredictionLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "predicted_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When prediction was made",
                    ),
                ),
                (
                    "prediction_type",
                    models.CharField(
                        choices=[
                            ("ATTENDANCE", "Attendance Fraud"),
                            ("BIOMETRIC", "Biometric Fraud"),
                            ("GPS", "GPS Spoofing"),
                            ("BEHAVIORAL", "Behavioral Anomaly"),
                        ],
                        help_text="Type of fraud predicted",
                        max_length=20,
                    ),
                ),
                (
                    "fraud_probability",
                    models.FloatField(help_text="Predicted fraud probability (0-1)"),
                ),
                (
                    "risk_level",
                    models.CharField(
                        choices=[
                            ("MINIMAL", "Minimal Risk"),
                            ("LOW", "Low Risk"),
                            ("MEDIUM", "Medium Risk"),
                            ("HIGH", "High Risk"),
                            ("CRITICAL", "Critical Risk"),
                        ],
                        db_index=True,
                        help_text="Predicted risk level",
                        max_length=20,
                    ),
                ),
                (
                    "model_confidence",
                    models.FloatField(help_text="ML model confidence (0-1)"),
                ),
                (
                    "features_used",
                    models.JSONField(
                        default=dict, help_text="Feature values used in prediction"
                    ),
                ),
                (
                    "baseline_deviation",
                    models.FloatField(
                        default=0.0,
                        help_text="Deviation from behavioral baseline (0-1)",
                    ),
                ),
                (
                    "anomaly_indicators",
                    models.JSONField(
                        default=list, help_text="List of anomaly indicators detected"
                    ),
                ),
                (
                    "model_version",
                    models.CharField(
                        default="1.0", help_text="ML model version used", max_length=50
                    ),
                ),
                (
                    "model_type",
                    models.CharField(
                        default="automl_classifier",
                        help_text="Type of ML model used",
                        max_length=50,
                    ),
                ),
                (
                    "prediction_lower_bound",
                    models.FloatField(
                        blank=True,
                        help_text="Lower bound of prediction interval (90% coverage)",
                        null=True,
                    ),
                ),
                (
                    "prediction_upper_bound",
                    models.FloatField(
                        blank=True,
                        help_text="Upper bound of prediction interval (90% coverage)",
                        null=True,
                    ),
                ),
                (
                    "confidence_interval_width",
                    models.FloatField(
                        blank=True,
                        help_text="Width of confidence interval (upper - lower)",
                        null=True,
                    ),
                ),
                (
                    "calibration_score",
                    models.FloatField(
                        blank=True,
                        help_text="Conformal predictor calibration quality (0-1)",
                        null=True,
                    ),
                ),
                (
                    "shap_values",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="SHAP feature contributions for this prediction",
                        null=True,
                    ),
                ),
                (
                    "explanation_text",
                    models.TextField(
                        blank=True,
                        help_text="Human-readable explanation (top contributing features)",
                    ),
                ),
                (
                    "actual_fraud_detected",
                    models.BooleanField(
                        blank=True,
                        help_text="Whether actual fraud was detected",
                        null=True,
                    ),
                ),
                (
                    "actual_fraud_score",
                    models.FloatField(
                        blank=True,
                        help_text="Actual fraud score from detection",
                        null=True,
                    ),
                ),
                (
                    "prediction_accuracy",
                    models.FloatField(
                        blank=True,
                        help_text="Prediction accuracy (for feedback loop)",
                        null=True,
                    ),
                ),
                (
                    "preventive_action_taken",
                    models.BooleanField(
                        default=False, help_text="Whether preventive action was taken"
                    ),
                ),
                (
                    "action_type",
                    models.CharField(
                        blank=True, help_text="Type of preventive action", max_length=50
                    ),
                ),
                (
                    "action_details",
                    models.TextField(blank=True, help_text="Details of action taken"),
                ),
            ],
            options={
                "verbose_name": "Fraud Prediction Log",
                "verbose_name_plural": "Fraud Prediction Logs",
                "db_table": "noc_fraud_prediction_log",
                "ordering": ["-predicted_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="GPSValidationLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "validated_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="Validation timestamp",
                    ),
                ),
                (
                    "result",
                    models.CharField(
                        choices=[
                            ("VALID", "Valid Location"),
                            ("SUSPICIOUS", "Suspicious Location"),
                            ("SPOOFED", "Likely Spoofed"),
                            ("LOW_ACCURACY", "Low Accuracy"),
                            ("NETWORK_MISMATCH", "Network Location Mismatch"),
                            ("IMPOSSIBLE_SPEED", "Impossible Speed Detected"),
                            ("GEOFENCE_VIOLATION", "Geofence Violation"),
                        ],
                        db_index=True,
                        help_text="Validation result",
                        max_length=30,
                    ),
                ),
                (
                    "gps_location",
                    django.contrib.gis.db.models.fields.PointField(
                        geography=True, help_text="Reported GPS coordinates", srid=4326
                    ),
                ),
                (
                    "gps_accuracy_meters",
                    models.FloatField(help_text="GPS accuracy in meters"),
                ),
                (
                    "network_location",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        help_text="Network-based location (cell tower/WiFi)",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "gps_network_distance_meters",
                    models.FloatField(
                        blank=True,
                        help_text="Distance between GPS and network location",
                        null=True,
                    ),
                ),
                (
                    "site_geofence_center",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        help_text="Site geofence center",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "distance_from_geofence_meters",
                    models.FloatField(
                        blank=True,
                        help_text="Distance from geofence boundary",
                        null=True,
                    ),
                ),
                (
                    "is_within_geofence",
                    models.BooleanField(
                        default=True, help_text="Whether location is within geofence"
                    ),
                ),
                (
                    "previous_location",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        help_text="Previous GPS location",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "previous_location_time",
                    models.DateTimeField(
                        blank=True, help_text="Previous location timestamp", null=True
                    ),
                ),
                (
                    "calculated_speed_kmh",
                    models.FloatField(
                        blank=True,
                        help_text="Calculated travel speed (km/h)",
                        null=True,
                    ),
                ),
                (
                    "is_impossible_speed",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Speed exceeds physical limits",
                    ),
                ),
                (
                    "fraud_score",
                    models.FloatField(
                        default=0.0, help_text="GPS fraud probability (0-1)"
                    ),
                ),
                (
                    "fraud_indicators",
                    models.JSONField(
                        default=list, help_text="List of detected fraud indicators"
                    ),
                ),
                (
                    "device_id",
                    models.CharField(
                        db_index=True,
                        help_text="Device reporting location",
                        max_length=100,
                    ),
                ),
                (
                    "validation_metadata",
                    models.JSONField(
                        default=dict, help_text="Additional validation data"
                    ),
                ),
                (
                    "flagged_for_review",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flagged for manual review",
                    ),
                ),
                (
                    "reviewed_at",
                    models.DateTimeField(
                        blank=True, help_text="Review timestamp", null=True
                    ),
                ),
                (
                    "review_notes",
                    models.TextField(blank=True, help_text="Review findings"),
                ),
            ],
            options={
                "verbose_name": "GPS Validation Log",
                "verbose_name_plural": "GPS Validation Logs",
                "db_table": "noc_gps_validation_log",
                "ordering": ["-validated_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="GuardActivityTracking",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "tracking_start",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="Start of tracking window",
                    ),
                ),
                (
                    "tracking_end",
                    models.DateTimeField(help_text="End of tracking window"),
                ),
                (
                    "shift_type",
                    models.CharField(
                        choices=[
                            ("DAY", "Day Shift"),
                            ("NIGHT", "Night Shift"),
                            ("SWING", "Swing Shift"),
                        ],
                        default="DAY",
                        help_text="Type of shift",
                        max_length=20,
                    ),
                ),
                (
                    "phone_events_count",
                    models.IntegerField(
                        default=0, help_text="Number of phone/app events"
                    ),
                ),
                (
                    "location_updates_count",
                    models.IntegerField(
                        default=0, help_text="Number of GPS location updates"
                    ),
                ),
                (
                    "movement_distance_meters",
                    models.FloatField(
                        default=0.0, help_text="Total movement distance (meters)"
                    ),
                ),
                (
                    "tasks_completed_count",
                    models.IntegerField(
                        default=0, help_text="Number of tasks completed"
                    ),
                ),
                (
                    "tour_checkpoints_scanned",
                    models.IntegerField(
                        default=0, help_text="Number of tour checkpoints scanned"
                    ),
                ),
                (
                    "inactivity_score",
                    models.FloatField(
                        default=0.0, help_text="Calculated inactivity score (0-1)"
                    ),
                ),
                (
                    "is_inactive",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether guard is currently inactive",
                    ),
                ),
                (
                    "consecutive_inactive_windows",
                    models.IntegerField(
                        default=0, help_text="Number of consecutive inactive windows"
                    ),
                ),
                (
                    "last_activity_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="Last detected activity timestamp",
                        null=True,
                    ),
                ),
                (
                    "last_location",
                    models.JSONField(
                        default=dict, help_text="Last known GPS coordinates"
                    ),
                ),
                (
                    "activity_metadata",
                    models.JSONField(
                        default=dict, help_text="Additional activity data"
                    ),
                ),
                (
                    "alert_generated",
                    models.BooleanField(
                        default=False,
                        help_text="Whether inactivity alert was generated",
                    ),
                ),
                (
                    "alert_resolved",
                    models.BooleanField(
                        default=False, help_text="Whether alert was resolved"
                    ),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True, help_text="When alert was resolved", null=True
                    ),
                ),
            ],
            options={
                "verbose_name": "Guard Activity Tracking",
                "verbose_name_plural": "Guard Activity Tracking",
                "db_table": "noc_guard_activity_tracking",
                "ordering": ["-tracking_start"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="InactivityAlert",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "detected_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When inactivity was detected",
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("LOW", "Low - Minor Inactivity"),
                            ("MEDIUM", "Medium - Concerning Pattern"),
                            ("HIGH", "High - Likely Sleeping"),
                            ("CRITICAL", "Critical - No Response"),
                        ],
                        db_index=True,
                        help_text="Severity of inactivity",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("DETECTED", "Detected"),
                            ("VERIFYING", "Verification in Progress"),
                            ("CONFIRMED", "Confirmed Inactivity"),
                            ("RESOLVED", "Resolved"),
                            ("FALSE_POSITIVE", "False Positive"),
                        ],
                        db_index=True,
                        default="DETECTED",
                        help_text="Alert status",
                        max_length=20,
                    ),
                ),
                (
                    "inactivity_score",
                    models.FloatField(help_text="Inactivity score (0-1)"),
                ),
                (
                    "inactivity_duration_minutes",
                    models.IntegerField(help_text="Duration of inactivity (minutes)"),
                ),
                (
                    "no_phone_activity",
                    models.BooleanField(
                        default=False, help_text="No phone/app activity detected"
                    ),
                ),
                (
                    "no_movement",
                    models.BooleanField(
                        default=False, help_text="No GPS movement detected"
                    ),
                ),
                (
                    "no_tasks_completed",
                    models.BooleanField(default=False, help_text="No tasks completed"),
                ),
                (
                    "no_tour_scans",
                    models.BooleanField(
                        default=False, help_text="No tour checkpoints scanned"
                    ),
                ),
                (
                    "is_deep_night",
                    models.BooleanField(
                        default=False,
                        help_text="Occurred during deep night hours (1-5 AM)",
                    ),
                ),
                (
                    "evidence_data",
                    models.JSONField(
                        default=dict, help_text="Activity counters and evidence"
                    ),
                ),
                (
                    "verification_attempted",
                    models.BooleanField(
                        default=False, help_text="Whether verification was attempted"
                    ),
                ),
                (
                    "verification_method",
                    models.CharField(
                        choices=[
                            ("NONE", "No Verification"),
                            ("CALL", "Phone Call"),
                            ("IVR", "Automated IVR"),
                            ("SUPERVISOR", "Supervisor Check"),
                            ("CAMERA", "CCTV Review"),
                        ],
                        default="NONE",
                        help_text="Verification method used",
                        max_length=20,
                    ),
                ),
                (
                    "verification_response",
                    models.TextField(
                        blank=True, help_text="Response from verification"
                    ),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True, help_text="When alert was resolved", null=True
                    ),
                ),
                (
                    "resolution_notes",
                    models.TextField(blank=True, help_text="Resolution details"),
                ),
            ],
            options={
                "verbose_name": "Inactivity Alert",
                "verbose_name_plural": "Inactivity Alerts",
                "db_table": "noc_inactivity_alert",
                "ordering": ["-detected_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="MLTrainingDataset",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "dataset_name",
                    models.CharField(
                        help_text="Unique dataset name", max_length=100, unique=True
                    ),
                ),
                (
                    "dataset_type",
                    models.CharField(
                        choices=[
                            ("FRAUD_DETECTION", "Fraud Detection"),
                            ("BEHAVIORAL_PROFILING", "Behavioral Profiling"),
                            ("ANOMALY_DETECTION", "Anomaly Detection"),
                        ],
                        help_text="Type of dataset",
                        max_length=30,
                    ),
                ),
                (
                    "version",
                    models.CharField(
                        default="1.0", help_text="Dataset version", max_length=20
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PREPARING", "Preparing"),
                            ("EXPORTING", "Exporting"),
                            ("EXPORTED", "Exported"),
                            ("TRAINING", "Training"),
                            ("TRAINED", "Trained"),
                            ("DEPLOYED", "Deployed"),
                            ("FAILED", "Failed"),
                        ],
                        db_index=True,
                        default="PREPARING",
                        help_text="Dataset status",
                        max_length=20,
                    ),
                ),
                (
                    "data_start_date",
                    models.DateField(help_text="Start date of data included"),
                ),
                (
                    "data_end_date",
                    models.DateField(help_text="End date of data included"),
                ),
                (
                    "total_records",
                    models.IntegerField(
                        default=0, help_text="Total records in dataset"
                    ),
                ),
                (
                    "fraud_records",
                    models.IntegerField(
                        default=0, help_text="Records labeled as fraud"
                    ),
                ),
                (
                    "normal_records",
                    models.IntegerField(
                        default=0, help_text="Records labeled as normal"
                    ),
                ),
                (
                    "bigquery_dataset_id",
                    models.CharField(
                        blank=True, help_text="BigQuery dataset ID", max_length=100
                    ),
                ),
                (
                    "bigquery_table_id",
                    models.CharField(
                        blank=True, help_text="BigQuery table ID", max_length=100
                    ),
                ),
                (
                    "bigquery_export_path",
                    models.CharField(
                        blank=True, help_text="GCS export path", max_length=500
                    ),
                ),
                (
                    "feature_columns",
                    models.JSONField(default=list, help_text="List of feature columns"),
                ),
                (
                    "label_column",
                    models.CharField(
                        default="is_fraud", help_text="Label column name", max_length=50
                    ),
                ),
                (
                    "training_started_at",
                    models.DateTimeField(
                        blank=True, help_text="When training started", null=True
                    ),
                ),
                (
                    "training_completed_at",
                    models.DateTimeField(
                        blank=True, help_text="When training completed", null=True
                    ),
                ),
                (
                    "training_duration_minutes",
                    models.IntegerField(
                        blank=True, help_text="Training duration (minutes)", null=True
                    ),
                ),
                (
                    "model_accuracy",
                    models.FloatField(
                        blank=True, help_text="Model accuracy (0-1)", null=True
                    ),
                ),
                (
                    "model_precision",
                    models.FloatField(
                        blank=True, help_text="Model precision (0-1)", null=True
                    ),
                ),
                (
                    "model_recall",
                    models.FloatField(
                        blank=True, help_text="Model recall (0-1)", null=True
                    ),
                ),
                (
                    "model_f1_score",
                    models.FloatField(
                        blank=True, help_text="Model F1 score (0-1)", null=True
                    ),
                ),
                (
                    "deployed_at",
                    models.DateTimeField(
                        blank=True, help_text="When model was deployed", null=True
                    ),
                ),
                (
                    "is_active_model",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this is the active production model",
                    ),
                ),
                (
                    "export_metadata",
                    models.JSONField(
                        default=dict, help_text="Export configuration and metadata"
                    ),
                ),
                (
                    "training_metadata",
                    models.JSONField(
                        default=dict, help_text="Training configuration and results"
                    ),
                ),
                (
                    "error_log",
                    models.TextField(blank=True, help_text="Error messages if failed"),
                ),
            ],
            options={
                "verbose_name": "ML Training Dataset",
                "verbose_name_plural": "ML Training Datasets",
                "db_table": "noc_ml_training_dataset",
                "ordering": ["-cdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="NonNegotiablesScorecard",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "check_date",
                    models.DateField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="Date of this evaluation",
                    ),
                ),
                (
                    "overall_health_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        help_text="Overall health: RED if any pillar is RED, AMBER if any is AMBER, else GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "overall_health_score",
                    models.IntegerField(
                        default=100,
                        help_text="Overall health score 0-100 (weighted average of pillar scores)",
                    ),
                ),
                (
                    "total_violations",
                    models.IntegerField(
                        default=0,
                        help_text="Total number of violations across all pillars",
                    ),
                ),
                (
                    "critical_violations",
                    models.IntegerField(
                        default=0,
                        help_text="Number of critical (RED) violations requiring immediate action",
                    ),
                ),
                (
                    "pillar_1_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 1: Right Guard at Right Post (coverage, attendance, geofence)",
                    ),
                ),
                (
                    "pillar_1_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_2_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 2: Supervise Relentlessly (tours, spot checks, checkpoint compliance)",
                    ),
                ),
                (
                    "pillar_2_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_3_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 3: 24/7 Control Desk (alert ack, escalation SLA, stale alerts)",
                    ),
                ),
                (
                    "pillar_3_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_4_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 4: Legal & Professional (PF/ESIC/UAN, payroll, compliance)",
                    ),
                ),
                (
                    "pillar_4_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_5_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 5: Support the Field (uniforms, logistics, work orders)",
                    ),
                ),
                (
                    "pillar_5_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_6_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 6: Record Everything (daily/weekly/monthly reports, documentation)",
                    ),
                ),
                (
                    "pillar_6_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "pillar_7_score",
                    models.IntegerField(
                        default=100,
                        help_text="Pillar 7: Respond to Emergencies (crisis response, IVR, panic button)",
                    ),
                ),
                (
                    "pillar_7_status",
                    models.CharField(
                        choices=[
                            ("GREEN", "Green - Compliant"),
                            ("AMBER", "Amber - Minor Issues"),
                            ("RED", "Red - Critical Violations"),
                        ],
                        default="GREEN",
                        max_length=10,
                    ),
                ),
                (
                    "violations_detail",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Detailed breakdown of violations per pillar with remediation actions",
                    ),
                ),
                (
                    "recommendations",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="AI-generated recommendations for improvement",
                    ),
                ),
                (
                    "auto_escalated_alerts",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of NOC alert IDs that were auto-created from violations",
                    ),
                ),
            ],
            options={
                "verbose_name": "Non-Negotiables Scorecard",
                "verbose_name_plural": "Non-Negotiables Scorecards",
                "db_table": "noc_non_negotiables_scorecard",
                "ordering": ["-check_date", "-cdtz"],
                "get_latest_by": ["check_date", "cdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="SecurityAnomalyConfig",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "scope",
                    models.CharField(
                        choices=[
                            ("TENANT", "Tenant-wide"),
                            ("CLIENT", "Client-specific"),
                            ("SITE", "Site-specific"),
                        ],
                        default="TENANT",
                        help_text="Scope of this configuration",
                        max_length=20,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Whether this configuration is active"
                    ),
                ),
                (
                    "max_continuous_work_hours",
                    models.IntegerField(
                        default=16,
                        help_text="Maximum continuous work hours before overtime alert",
                        validators=[
                            django.core.validators.MinValueValidator(8),
                            django.core.validators.MaxValueValidator(24),
                        ],
                    ),
                ),
                (
                    "min_travel_time_minutes",
                    models.IntegerField(
                        default=30,
                        help_text="Minimum travel time between distant sites (minutes)",
                        validators=[django.core.validators.MinValueValidator(5)],
                    ),
                ),
                (
                    "max_travel_speed_kmh",
                    models.IntegerField(
                        default=150,
                        help_text="Maximum believable travel speed (km/h)",
                        validators=[
                            django.core.validators.MinValueValidator(50),
                            django.core.validators.MaxValueValidator(300),
                        ],
                    ),
                ),
                (
                    "unauthorized_access_severity",
                    models.CharField(
                        choices=[
                            ("LOW", "Low"),
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("CRITICAL", "Critical"),
                        ],
                        default="CRITICAL",
                        help_text="Severity for unauthorized site access",
                        max_length=20,
                    ),
                ),
                (
                    "inactivity_detection_enabled",
                    models.BooleanField(
                        default=True,
                        help_text="Enable night shift inactivity detection",
                    ),
                ),
                (
                    "inactivity_window_minutes",
                    models.IntegerField(
                        default=120,
                        help_text="Time window for inactivity detection (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(30),
                            django.core.validators.MaxValueValidator(360),
                        ],
                    ),
                ),
                (
                    "inactivity_score_threshold",
                    models.FloatField(
                        default=0.8,
                        help_text="Inactivity score threshold (0-1)",
                        validators=[
                            django.core.validators.MinValueValidator(0.0),
                            django.core.validators.MaxValueValidator(1.0),
                        ],
                    ),
                ),
                (
                    "deep_night_hours_start",
                    models.IntegerField(
                        default=1,
                        help_text="Deep night hours start (hour of day)",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(23),
                        ],
                    ),
                ),
                (
                    "deep_night_hours_end",
                    models.IntegerField(
                        default=5,
                        help_text="Deep night hours end (hour of day)",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(23),
                        ],
                    ),
                ),
                (
                    "biometric_confidence_min",
                    models.FloatField(
                        default=0.7,
                        help_text="Minimum biometric confidence score",
                        validators=[
                            django.core.validators.MinValueValidator(0.0),
                            django.core.validators.MaxValueValidator(1.0),
                        ],
                    ),
                ),
                (
                    "gps_accuracy_max_meters",
                    models.IntegerField(
                        default=100,
                        help_text="Maximum acceptable GPS accuracy (meters)",
                        validators=[
                            django.core.validators.MinValueValidator(10),
                            django.core.validators.MaxValueValidator(1000),
                        ],
                    ),
                ),
                (
                    "geofence_violation_threshold_meters",
                    models.IntegerField(
                        default=200,
                        help_text="Distance outside geofence before alert (meters)",
                        validators=[
                            django.core.validators.MinValueValidator(50),
                            django.core.validators.MaxValueValidator(1000),
                        ],
                    ),
                ),
                (
                    "concurrent_biometric_window_minutes",
                    models.IntegerField(
                        default=5,
                        help_text="Time window for detecting concurrent biometric use",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(30),
                        ],
                    ),
                ),
            ],
            options={
                "verbose_name": "Security Anomaly Config",
                "verbose_name_plural": "Security Anomaly Configs",
                "db_table": "noc_security_anomaly_config",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="ShiftScheduleCache",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "shift_date",
                    models.DateField(db_index=True, help_text="Date of shift"),
                ),
                (
                    "shift_type",
                    models.CharField(
                        choices=[
                            ("DAY", "Day Shift"),
                            ("NIGHT", "Night Shift"),
                            ("SWING", "Swing Shift"),
                            ("ROTATING", "Rotating"),
                        ],
                        default="DAY",
                        help_text="Type of shift",
                        max_length=20,
                    ),
                ),
                (
                    "scheduled_start",
                    models.DateTimeField(help_text="Scheduled start time"),
                ),
                ("scheduled_end", models.DateTimeField(help_text="Scheduled end time")),
                (
                    "is_critical",
                    models.BooleanField(
                        default=False, help_text="Whether this is a critical shift"
                    ),
                ),
                (
                    "is_substitute",
                    models.BooleanField(
                        default=False, help_text="Whether person is a substitute"
                    ),
                ),
                (
                    "cache_valid_until",
                    models.DateTimeField(help_text="When this cache entry expires"),
                ),
                (
                    "schedule_metadata",
                    models.JSONField(
                        default=dict, help_text="Additional schedule information"
                    ),
                ),
            ],
            options={
                "verbose_name": "Shift Schedule Cache",
                "verbose_name_plural": "Shift Schedule Cache",
                "db_table": "noc_shift_schedule_cache",
                "ordering": ["shift_date", "scheduled_start"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="SiteAuditSchedule",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "enabled",
                    models.BooleanField(
                        default=True,
                        help_text="Whether real-time auditing is enabled for this site",
                    ),
                ),
                (
                    "audit_frequency_minutes",
                    models.IntegerField(
                        choices=[
                            (5, "5 minutes - Critical sites"),
                            (15, "15 minutes - High priority"),
                            (30, "30 minutes - Standard"),
                            (60, "60 minutes - Low priority"),
                        ],
                        default=15,
                        help_text="How often to run comprehensive audits (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(5),
                            django.core.validators.MaxValueValidator(60),
                        ],
                    ),
                ),
                (
                    "heartbeat_frequency_minutes",
                    models.IntegerField(
                        default=5,
                        help_text="How often to check critical signals (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(15),
                        ],
                    ),
                ),
                (
                    "deep_audit_frequency_hours",
                    models.IntegerField(
                        default=1,
                        help_text="How often to run deep pattern analysis (hours)",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(24),
                        ],
                    ),
                ),
                (
                    "critical_signals",
                    models.JSONField(
                        default=list,
                        help_text="List of critical signals to monitor: ['phone_events', 'location_updates', 'tour_completion', 'task_completion']",
                    ),
                ),
                (
                    "signal_thresholds",
                    models.JSONField(
                        default=dict,
                        help_text="Threshold configuration per signal type",
                    ),
                ),
                (
                    "maintenance_windows",
                    models.JSONField(
                        default=list,
                        help_text="List of maintenance windows when auditing is paused",
                    ),
                ),
                (
                    "alert_on_finding",
                    models.BooleanField(
                        default=True, help_text="Auto-create NOC alerts for findings"
                    ),
                ),
                (
                    "alert_severity_threshold",
                    models.CharField(
                        choices=[
                            ("LOW", "Low - Alert on all findings"),
                            ("MEDIUM", "Medium - Alert on medium+ findings"),
                            ("HIGH", "High - Alert on high/critical only"),
                            ("CRITICAL", "Critical - Alert only on critical"),
                        ],
                        default="MEDIUM",
                        help_text="Minimum severity to create alerts",
                        max_length=20,
                    ),
                ),
                (
                    "collect_evidence",
                    models.BooleanField(
                        default=True,
                        help_text="Collect and attach evidence to findings",
                    ),
                ),
                (
                    "evidence_lookback_minutes",
                    models.IntegerField(
                        default=120,
                        help_text="How far back to collect evidence (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(30),
                            django.core.validators.MaxValueValidator(480),
                        ],
                    ),
                ),
                (
                    "last_audit_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When the last comprehensive audit ran",
                        null=True,
                    ),
                ),
                (
                    "last_heartbeat_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When the last heartbeat check ran",
                        null=True,
                    ),
                ),
                (
                    "total_audits_run",
                    models.IntegerField(
                        default=0, help_text="Total number of audits run for this site"
                    ),
                ),
                (
                    "total_findings",
                    models.IntegerField(
                        default=0, help_text="Total findings detected for this site"
                    ),
                ),
            ],
            options={
                "verbose_name": "Site Audit Schedule",
                "verbose_name_plural": "Site Audit Schedules",
                "db_table": "noc_site_audit_schedule",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="TaskComplianceConfig",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "scope",
                    models.CharField(
                        choices=[
                            ("TENANT", "Tenant-wide"),
                            ("CLIENT", "Client-specific"),
                            ("SITE", "Site-specific"),
                        ],
                        default="TENANT",
                        help_text="Scope of this configuration",
                        max_length=20,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True, help_text="Whether this configuration is active"
                    ),
                ),
                (
                    "critical_task_sla_minutes",
                    models.IntegerField(
                        default=15,
                        help_text="SLA target for critical tasks (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(5),
                            django.core.validators.MaxValueValidator(120),
                        ],
                    ),
                ),
                (
                    "high_task_sla_minutes",
                    models.IntegerField(
                        default=30,
                        help_text="SLA target for high priority tasks (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(10),
                            django.core.validators.MaxValueValidator(240),
                        ],
                    ),
                ),
                (
                    "medium_task_sla_minutes",
                    models.IntegerField(
                        default=60,
                        help_text="SLA target for medium priority tasks (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(15),
                            django.core.validators.MaxValueValidator(480),
                        ],
                    ),
                ),
                (
                    "mandatory_tour_enforcement",
                    models.BooleanField(
                        default=True, help_text="Enforce mandatory tour completion"
                    ),
                ),
                (
                    "tour_grace_period_minutes",
                    models.IntegerField(
                        default=30,
                        help_text="Grace period before tour alert (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(5),
                            django.core.validators.MaxValueValidator(120),
                        ],
                    ),
                ),
                (
                    "require_all_checkpoints",
                    models.BooleanField(
                        default=True, help_text="Require all checkpoints to be scanned"
                    ),
                ),
                (
                    "min_checkpoint_percentage",
                    models.IntegerField(
                        default=80,
                        help_text="Minimum percentage of checkpoints required",
                        validators=[
                            django.core.validators.MinValueValidator(50),
                            django.core.validators.MaxValueValidator(100),
                        ],
                    ),
                ),
                (
                    "auto_escalate_overdue",
                    models.BooleanField(
                        default=True,
                        help_text="Automatically escalate overdue critical tasks",
                    ),
                ),
                (
                    "escalation_delay_minutes",
                    models.IntegerField(
                        default=15,
                        help_text="Delay before auto-escalation (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(5),
                            django.core.validators.MaxValueValidator(60),
                        ],
                    ),
                ),
                (
                    "critical_overdue_severity",
                    models.CharField(
                        choices=[("HIGH", "High"), ("CRITICAL", "Critical")],
                        default="CRITICAL",
                        help_text="Severity for overdue critical tasks",
                        max_length=20,
                    ),
                ),
                (
                    "tour_missed_severity",
                    models.CharField(
                        choices=[
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("CRITICAL", "Critical"),
                        ],
                        default="HIGH",
                        help_text="Severity for missed mandatory tours",
                        max_length=20,
                    ),
                ),
            ],
            options={
                "verbose_name": "Task Compliance Config",
                "verbose_name_plural": "Task Compliance Configs",
                "db_table": "noc_task_compliance_config",
                "ordering": ["mdtz"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="TourComplianceLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "scheduled_date",
                    models.DateField(
                        db_index=True, help_text="Date tour was scheduled"
                    ),
                ),
                (
                    "scheduled_time",
                    models.TimeField(help_text="Time tour was scheduled"),
                ),
                (
                    "scheduled_datetime",
                    models.DateTimeField(
                        db_index=True, help_text="Combined scheduled datetime"
                    ),
                ),
                (
                    "tour_type",
                    models.CharField(
                        choices=[
                            ("ROUTINE", "Routine Patrol"),
                            ("CRITICAL", "Critical Security Check"),
                            ("PERIMETER", "Perimeter Inspection"),
                            ("BUILDING", "Building Inspection"),
                        ],
                        default="ROUTINE",
                        help_text="Type of tour",
                        max_length=50,
                    ),
                ),
                (
                    "is_mandatory",
                    models.BooleanField(
                        default=True, help_text="Whether tour is mandatory"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("SCHEDULED", "Scheduled"),
                            ("IN_PROGRESS", "In Progress"),
                            ("COMPLETED", "Completed"),
                            ("OVERDUE", "Overdue"),
                            ("INCOMPLETE", "Incomplete"),
                            ("MISSED", "Missed"),
                        ],
                        db_index=True,
                        default="SCHEDULED",
                        help_text="Current tour status",
                        max_length=20,
                    ),
                ),
                (
                    "compliance_status",
                    models.CharField(
                        choices=[
                            ("COMPLIANT", "Compliant"),
                            ("SLA_BREACH", "SLA Breach"),
                            ("PARTIAL_COMPLETION", "Partial Completion"),
                            ("NOT_STARTED", "Not Started"),
                            ("GUARD_ABSENT", "Guard Absent"),
                        ],
                        db_index=True,
                        default="COMPLIANT",
                        help_text="Compliance status",
                        max_length=30,
                    ),
                ),
                (
                    "total_checkpoints",
                    models.IntegerField(
                        default=0, help_text="Total checkpoints in tour"
                    ),
                ),
                (
                    "scanned_checkpoints",
                    models.IntegerField(default=0, help_text="Checkpoints scanned"),
                ),
                (
                    "checkpoint_coverage_percent",
                    models.FloatField(
                        default=0.0, help_text="Percentage of checkpoints covered"
                    ),
                ),
                (
                    "started_at",
                    models.DateTimeField(
                        blank=True, help_text="When tour was started", null=True
                    ),
                ),
                (
                    "completed_at",
                    models.DateTimeField(
                        blank=True, help_text="When tour was completed", null=True
                    ),
                ),
                (
                    "duration_minutes",
                    models.IntegerField(
                        blank=True, help_text="Tour duration (minutes)", null=True
                    ),
                ),
                (
                    "overdue_by_minutes",
                    models.IntegerField(
                        default=0, help_text="Minutes overdue from scheduled time"
                    ),
                ),
                (
                    "guard_checked_in",
                    models.BooleanField(
                        default=False, help_text="Whether guard checked in for shift"
                    ),
                ),
                (
                    "guard_present",
                    models.BooleanField(
                        default=False, help_text="Whether guard was present at site"
                    ),
                ),
                (
                    "tour_data",
                    models.JSONField(default=dict, help_text="Additional tour details"),
                ),
                (
                    "investigated_at",
                    models.DateTimeField(
                        blank=True, help_text="When investigated", null=True
                    ),
                ),
                (
                    "investigation_notes",
                    models.TextField(blank=True, help_text="Investigation findings"),
                ),
            ],
            options={
                "verbose_name": "Tour Compliance Log",
                "verbose_name_plural": "Tour Compliance Logs",
                "db_table": "noc_tour_compliance_log",
                "ordering": ["-scheduled_datetime"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="AttendanceAnomalyLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "anomaly_type",
                    models.CharField(
                        choices=[
                            ("WRONG_PERSON", "Wrong Person at Site"),
                            ("UNAUTHORIZED_SITE", "Unauthorized Site Access"),
                            ("IMPOSSIBLE_SHIFTS", "Impossible Back-to-Back Shifts"),
                            ("OVERTIME_VIOLATION", "Overtime Violation"),
                            ("BUDDY_PUNCHING", "Buddy Punching Detected"),
                            ("GPS_SPOOFING", "GPS Spoofing Suspected"),
                            ("GEOFENCE_VIOLATION", "Geofence Violation"),
                            ("BIOMETRIC_ANOMALY", "Biometric Pattern Anomaly"),
                            ("SCHEDULE_MISMATCH", "Schedule Mismatch"),
                        ],
                        db_index=True,
                        help_text="Type of anomaly detected",
                        max_length=30,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("LOW", "Low"),
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("CRITICAL", "Critical"),
                        ],
                        db_index=True,
                        help_text="Severity of the anomaly",
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("DETECTED", "Detected"),
                            ("INVESTIGATING", "Under Investigation"),
                            ("CONFIRMED", "Confirmed Fraud"),
                            ("FALSE_POSITIVE", "False Positive"),
                            ("RESOLVED", "Resolved"),
                        ],
                        db_index=True,
                        default="DETECTED",
                        help_text="Investigation status",
                        max_length=20,
                    ),
                ),
                (
                    "detected_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When anomaly was detected",
                    ),
                ),
                (
                    "confidence_score",
                    models.FloatField(help_text="Detection confidence (0-1)"),
                ),
                (
                    "distance_km",
                    models.FloatField(
                        blank=True,
                        help_text="Distance for travel analysis (km)",
                        null=True,
                    ),
                ),
                (
                    "time_available_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Time available for travel (minutes)",
                        null=True,
                    ),
                ),
                (
                    "time_required_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Time required for travel (minutes)",
                        null=True,
                    ),
                ),
                (
                    "continuous_work_hours",
                    models.FloatField(
                        blank=True,
                        help_text="Continuous work hours (for overtime)",
                        null=True,
                    ),
                ),
                (
                    "evidence_data",
                    models.JSONField(
                        default=dict, help_text="Additional evidence and metadata"
                    ),
                ),
                (
                    "investigated_at",
                    models.DateTimeField(
                        blank=True, help_text="When investigation completed", null=True
                    ),
                ),
                (
                    "investigation_notes",
                    models.TextField(blank=True, help_text="Investigation findings"),
                ),
                (
                    "action_taken",
                    models.TextField(blank=True, help_text="Actions taken to resolve"),
                ),
                (
                    "attendance_event",
                    models.ForeignKey(
                        blank=True,
                        help_text="Related attendance event",
                        null=True,
                        on_delete=django.db.models.deletion.SET_NULL,
                        related_name="detected_anomalies",
                        to="attendance.peopleeventlog",
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance Anomaly Log",
                "verbose_name_plural": "Attendance Anomaly Logs",
                "db_table": "noc_attendance_anomaly_log",
                "ordering": ["-detected_at"],
                "abstract": False,
            },
        ),
    ]
