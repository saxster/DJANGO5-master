<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Monthly Compliance Audit Pack</title>
    <style>
        @page { size: A4; margin: 20mm; }
        body { font-family: 'Segoe UI', Arial, sans-serif; color: #333; line-height: 1.6; }
        .header { text-align: center; border-bottom: 4px solid #2c3e50; padding-bottom: 20px; margin-bottom: 30px; }
        .header h1 { color: #2c3e50; margin: 0; font-size: 28px; }
        .header .subtitle { color: #7f8c8d; font-size: 14px; }
        .metadata { background: #ecf0f1; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .metadata table { width: 100%; }
        .metadata td { padding: 5px; }
        .section { page-break-inside: avoid; margin: 30px 0; }
        .section h2 { color: #2c3e50; border-left: 5px solid #3498db; padding-left: 10px; }
        .metric-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0; }
        .metric-card { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .metric-card h3 { margin-top: 0; color: #34495e; font-size: 16px; }
        .metric-value { font-size: 32px; font-weight: bold; color: #3498db; margin: 10px 0; }
        .metric-label { color: #7f8c8d; font-size: 14px; }
        .compliance-bar { height: 30px; background: #ecf0f1; border-radius: 15px; overflow: hidden; margin: 10px 0; }
        .compliance-fill { height: 100%; background: linear-gradient(90deg, #27ae60, #2ecc71); text-align: center; color: white; font-weight: bold; line-height: 30px; }
        .compliance-warning { background: linear-gradient(90deg, #f39c12, #f1c40f); }
        .compliance-critical { background: linear-gradient(90deg, #c0392b, #e74c3c); }
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        th { background: #34495e; color: white; padding: 12px; text-align: left; font-size: 14px; }
        td { padding: 10px; border-bottom: 1px solid #ddd; font-size: 13px; }
        .evidence { background: #f8f9fa; padding: 15px; margin: 20px 0; border-left: 3px solid #3498db; }
        .signature { margin-top: 60px; border-top: 2px solid #ddd; padding-top: 20px; }
        .signature-line { border-bottom: 1px solid #333; width: 300px; margin: 40px 0 10px; display: inline-block; }
    </style>
</head>
<body>
    <div class="header">
        <h1>Monthly Compliance Audit Pack</h1>
        <div class="subtitle">{{ pack.metadata.standard }}</div>
    </div>

    <div class="metadata">
        <table>
            <tr>
                <td><strong>Client:</strong> {{ pack.metadata.client }}</td>
                <td><strong>Period:</strong> {{ pack.metadata.period }}</td>
            </tr>
            <tr>
                <td><strong>Generated:</strong> {{ pack.metadata.generated_at }}</td>
                <td><strong>Standard:</strong> {{ pack.metadata.standard }}</td>
            </tr>
        </table>
    </div>

    <!-- Executive Summary -->
    <div class="section">
        <h2>Executive Summary</h2>
        <div class="metric-grid">
            <div class="metric-card">
                <h3>Attendance Compliance</h3>
                <div class="metric-value">{{ pack.attendance_compliance.compliance_rate }}%</div>
                <div class="metric-label">{{ pack.attendance_compliance.on_time_shifts }} / {{ pack.attendance_compliance.total_shifts }} on-time shifts</div>
                <div class="compliance-bar">
                    <div class="compliance-fill {% if pack.attendance_compliance.compliance_rate < 80 %}compliance-critical{% elif pack.attendance_compliance.compliance_rate < 90 %}compliance-warning{% endif %}" 
                         style="width: {{ pack.attendance_compliance.compliance_rate }}%;">
                        {{ pack.attendance_compliance.compliance_rate }}%
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Patrol Coverage</h3>
                <div class="metric-value">{{ pack.patrol_coverage.coverage_rate }}%</div>
                <div class="metric-label">{{ pack.patrol_coverage.completed_tours }} / {{ pack.patrol_coverage.scheduled_tours }} tours completed</div>
                <div class="compliance-bar">
                    <div class="compliance-fill {% if pack.patrol_coverage.coverage_rate < 80 %}compliance-critical{% elif pack.patrol_coverage.coverage_rate < 90 %}compliance-warning{% endif %}"
                         style="width: {{ pack.patrol_coverage.coverage_rate }}%;">
                        {{ pack.patrol_coverage.coverage_rate }}%
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h3>SLA Performance</h3>
                <div class="metric-value">{{ pack.sla_performance.sla_compliance }}%</div>
                <div class="metric-label">{{ pack.sla_performance.resolved_on_time }} / {{ pack.sla_performance.total_tickets }} resolved on-time</div>
                <div class="compliance-bar">
                    <div class="compliance-fill {% if pack.sla_performance.sla_compliance < 80 %}compliance-critical{% elif pack.sla_performance.sla_compliance < 90 %}compliance-warning{% endif %}"
                         style="width: {{ pack.sla_performance.sla_compliance }}%;">
                        {{ pack.sla_performance.sla_compliance }}%
                    </div>
                </div>
            </div>

            <div class="metric-card">
                <h3>Device Uptime</h3>
                <div class="metric-value">{{ pack.device_uptime.uptime_rate }}%</div>
                <div class="metric-label">{{ pack.device_uptime.operational_devices }} / {{ pack.device_uptime.total_devices }} devices operational</div>
                <div class="compliance-bar">
                    <div class="compliance-fill {% if pack.device_uptime.uptime_rate < 95 %}compliance-critical{% elif pack.device_uptime.uptime_rate < 98 %}compliance-warning{% endif %}"
                         style="width: {{ pack.device_uptime.uptime_rate }}%;">
                        {{ pack.device_uptime.uptime_rate }}%
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Incident Response -->
    <div class="section">
        <h2>Incident Response Metrics</h2>
        <table>
            <tr>
                <th>Metric</th>
                <th>Value</th>
            </tr>
            <tr>
                <td>Total Incidents</td>
                <td>{{ pack.incident_response.total_incidents }}</td>
            </tr>
            <tr>
                <td>Mean Time to Resolution (MTTR)</td>
                <td>{{ pack.incident_response.avg_mttr_hours }} hours</td>
            </tr>
        </table>
    </div>

    <!-- Audit Trail Summary -->
    <div class="section">
        <h2>Audit Trail Summary</h2>
        <table>
            <tr>
                <th>Severity</th>
                <th>Count</th>
            </tr>
            <tr>
                <td>Critical</td>
                <td>{{ pack.audit_summary.by_severity.critical }}</td>
            </tr>
            <tr>
                <td>High</td>
                <td>{{ pack.audit_summary.by_severity.high }}</td>
            </tr>
            <tr>
                <td>Medium</td>
                <td>{{ pack.audit_summary.by_severity.medium }}</td>
            </tr>
            <tr>
                <td>Low</td>
                <td>{{ pack.audit_summary.by_severity.low }}</td>
            </tr>
            <tr style="font-weight: bold; background: #ecf0f1;">
                <td>Total Events</td>
                <td>{{ pack.audit_summary.total_events }}</td>
            </tr>
        </table>
    </div>

    <!-- Evidence Appendix -->
    <div class="section">
        <h2>Evidence Appendix</h2>
        <div class="evidence">
            <strong>Supporting Documentation:</strong>
            <ul>
                <li>Raw attendance logs ({{ pack.attendance_compliance.total_shifts }} records)</li>
                <li>Tour completion reports ({{ pack.patrol_coverage.scheduled_tours }} tours)</li>
                <li>SLA tracking data ({{ pack.sla_performance.total_tickets }} tickets)</li>
                <li>Device health logs ({{ pack.device_uptime.total_devices }} devices)</li>
                <li>Audit trail ({{ pack.audit_summary.total_events }} events)</li>
            </ul>
        </div>
    </div>

    <!-- Signature Block -->
    <div class="signature">
        <p><strong>Prepared by:</strong></p>
        <div class="signature-line"></div>
        <p style="margin-top: 0;">Operations Manager</p>
        
        <p style="margin-top: 40px;"><strong>Reviewed by:</strong></p>
        <div class="signature-line"></div>
        <p style="margin-top: 0;">Compliance Officer</p>
    </div>

    <div style="margin-top: 60px; font-size: 11px; color: #7f8c8d; text-align: center; border-top: 1px solid #ddd; padding-top: 20px;">
        <em>This report is generated automatically from operational systems. All data is retained for regulatory compliance.</em>
    </div>
</body>
</html>
