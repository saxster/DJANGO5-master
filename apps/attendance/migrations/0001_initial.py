# Generated by Django 5.2.7 on 2025-11-09 10:20

import apps.attendance.managers
import apps.attendance.models.approval_request_actions
import apps.attendance.models.attendance_alert_actions
import apps.attendance.models.auto_approval_rule_actions
import apps.attendance.models.people_eventlog
import apps.core.fields.encrypted_json_field
import apps.peoples.models.base_model
import concurrency.fields
import django.contrib.gis.db.models.fields
import django.contrib.postgres.fields
import django.core.validators
import django.utils.timezone
import uuid
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = []

    operations = [
        migrations.CreateModel(
            name="AlertEscalation",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "escalated_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When escalation occurred",
                    ),
                ),
                (
                    "escalation_level",
                    models.IntegerField(
                        default=1,
                        help_text="Escalation level (1 = first escalation, 2 = second, etc.)",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(5),
                        ],
                    ),
                ),
                (
                    "reason",
                    models.TextField(blank=True, help_text="Reason for escalation"),
                ),
                (
                    "acknowledged",
                    models.BooleanField(
                        default=False,
                        help_text="Whether escalated recipient acknowledged",
                    ),
                ),
                (
                    "acknowledged_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When escalation was acknowledged",
                        null=True,
                    ),
                ),
            ],
            options={
                "verbose_name": "Alert Escalation",
                "verbose_name_plural": "Alert Escalations",
                "db_table": "attendance_alert_escalation",
                "ordering": ["-escalated_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="AlertRule",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "rule_name",
                    models.CharField(
                        help_text="Descriptive name for this rule", max_length=100
                    ),
                ),
                (
                    "rule_code",
                    models.CharField(
                        db_index=True,
                        help_text="Unique code for this rule",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "alert_type",
                    models.CharField(
                        choices=[
                            ("NO_SHOW", "No-Show Alert"),
                            ("LATE_CHECKIN", "Late Check-in Alert"),
                            ("WRONG_POST", "Wrong Post Alert"),
                            ("MISSING_CHECKOUT", "Missing Check-out Alert"),
                            ("COVERAGE_GAP", "Coverage Gap Alert"),
                            ("OVERTIME_WARNING", "Overtime Warning"),
                            ("REST_VIOLATION", "Rest Period Violation"),
                            ("MULTIPLE_MISMATCH", "Multiple Mismatch Alert"),
                            ("GEOFENCE_BREACH", "Geofence Breach Alert"),
                            ("CERT_EXPIRY", "Certification Expiry Alert"),
                            ("CUSTOM", "Custom Alert"),
                        ],
                        db_index=True,
                        help_text="Type of alert this rule generates",
                        max_length=30,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("CRITICAL", "Critical"),
                            ("HIGH", "High"),
                            ("MEDIUM", "Medium"),
                            ("LOW", "Low"),
                            ("INFO", "Informational"),
                        ],
                        db_index=True,
                        default="MEDIUM",
                        help_text="Alert severity level",
                        max_length=10,
                    ),
                ),
                (
                    "active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this rule is currently active",
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        blank=True, help_text="Description of when this alert triggers"
                    ),
                ),
                (
                    "threshold_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Time threshold in minutes (e.g., 30 for no-show)",
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(1440),
                        ],
                    ),
                ),
                (
                    "threshold_count",
                    models.IntegerField(
                        blank=True,
                        help_text="Count threshold (e.g., 3 for multiple mismatches)",
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(100),
                        ],
                    ),
                ),
                (
                    "threshold_percentage",
                    models.FloatField(
                        blank=True,
                        help_text="Percentage threshold (e.g., 50% for coverage gap)",
                        null=True,
                        validators=[
                            django.core.validators.MinValueValidator(0.0),
                            django.core.validators.MaxValueValidator(100.0),
                        ],
                    ),
                ),
                (
                    "applies_to_risk_levels",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="Post risk levels this rule applies to (empty = all)",
                    ),
                ),
                (
                    "send_notification",
                    models.BooleanField(
                        default=True, help_text="Send notification when alert triggers"
                    ),
                ),
                (
                    "create_ticket",
                    models.BooleanField(
                        default=False,
                        help_text="Create helpdesk ticket when alert triggers",
                    ),
                ),
                (
                    "notification_template",
                    models.TextField(
                        blank=True,
                        help_text="Notification message template (supports variables)",
                    ),
                ),
                (
                    "escalation_enabled",
                    models.BooleanField(
                        default=False,
                        help_text="Enable escalation if alert not acknowledged",
                    ),
                ),
                (
                    "escalation_delay_minutes",
                    models.IntegerField(
                        default=30,
                        help_text="Minutes to wait before escalating",
                        validators=[
                            django.core.validators.MinValueValidator(5),
                            django.core.validators.MaxValueValidator(1440),
                        ],
                    ),
                ),
                (
                    "deduplicate_window_minutes",
                    models.IntegerField(
                        default=60,
                        help_text="Don't create duplicate alerts within this window (minutes)",
                        validators=[
                            django.core.validators.MinValueValidator(1),
                            django.core.validators.MaxValueValidator(1440),
                        ],
                    ),
                ),
                (
                    "times_triggered",
                    models.IntegerField(
                        default=0, help_text="Number of times this rule has triggered"
                    ),
                ),
                (
                    "last_triggered_at",
                    models.DateTimeField(
                        blank=True, help_text="When this rule last triggered", null=True
                    ),
                ),
                (
                    "rule_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Extensible rule configuration",
                    ),
                ),
            ],
            options={
                "verbose_name": "Alert Rule",
                "verbose_name_plural": "Alert Rules",
                "db_table": "attendance_alert_rule",
                "ordering": ["severity", "rule_name"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="ApprovalAction",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "action",
                    models.CharField(
                        choices=[
                            ("CREATED", "Request Created"),
                            ("APPROVED", "Approved"),
                            ("REJECTED", "Rejected"),
                            ("CANCELLED", "Cancelled"),
                            ("EXPIRED", "Expired"),
                            ("ESCALATED", "Escalated to Manager"),
                            ("COMMENT_ADDED", "Comment Added"),
                        ],
                        db_index=True,
                        help_text="Type of action taken",
                        max_length=20,
                    ),
                ),
                (
                    "action_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When action was taken",
                    ),
                ),
                (
                    "notes",
                    models.TextField(blank=True, help_text="Notes about this action"),
                ),
                (
                    "action_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Additional metadata about action",
                    ),
                ),
            ],
            options={
                "verbose_name": "Approval Action",
                "verbose_name_plural": "Approval Actions",
                "db_table": "attendance_approval_action",
                "ordering": ["-action_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="ApprovalRequest",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "request_type",
                    models.CharField(
                        choices=[
                            ("VALIDATION_OVERRIDE", "Validation Check-in Override"),
                            ("EMERGENCY_ASSIGNMENT", "Emergency Assignment"),
                            ("SHIFT_CHANGE", "Shift Change Request"),
                            ("POST_REASSIGNMENT", "Post Reassignment"),
                            ("REST_PERIOD_WAIVER", "Rest Period Waiver"),
                            ("LATE_CHECKIN_APPROVAL", "Late Check-in Approval"),
                            ("SITE_TRANSFER", "Site Transfer"),
                            ("COVERAGE_GAP_FILL", "Coverage Gap Fill"),
                        ],
                        db_index=True,
                        help_text="Type of approval request",
                        max_length=30,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Review"),
                            ("AUTO_APPROVED", "Auto-Approved"),
                            ("MANUALLY_APPROVED", "Manually Approved"),
                            ("REJECTED", "Rejected"),
                            ("EXPIRED", "Expired"),
                            ("CANCELLED", "Cancelled"),
                        ],
                        db_index=True,
                        default="PENDING",
                        help_text="Current status of request",
                        max_length=20,
                    ),
                ),
                (
                    "priority",
                    models.CharField(
                        choices=[
                            ("URGENT", "Urgent"),
                            ("HIGH", "High"),
                            ("NORMAL", "Normal"),
                            ("LOW", "Low"),
                        ],
                        db_index=True,
                        default="NORMAL",
                        help_text="Request priority",
                        max_length=10,
                    ),
                ),
                (
                    "title",
                    models.CharField(
                        help_text="Short description of request", max_length=200
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        help_text="Detailed description and justification"
                    ),
                ),
                (
                    "reason_code",
                    models.CharField(
                        blank=True,
                        help_text="Machine-readable reason code (e.g., 'EMERGENCY', 'COVERAGE_GAP')",
                        max_length=50,
                    ),
                ),
                (
                    "validation_failure_reason",
                    models.CharField(
                        blank=True,
                        help_text="Original validation failure code (if override request)",
                        max_length=50,
                    ),
                ),
                (
                    "validation_failure_details",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Details from ValidationResult (if override request)",
                    ),
                ),
                (
                    "reviewed_at",
                    models.DateTimeField(
                        blank=True,
                        db_index=True,
                        help_text="When request was reviewed",
                        null=True,
                    ),
                ),
                (
                    "approval_notes",
                    models.TextField(blank=True, help_text="Notes from reviewer"),
                ),
                (
                    "rejection_reason",
                    models.TextField(blank=True, help_text="Reason for rejection"),
                ),
                (
                    "auto_approved",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this was automatically approved",
                    ),
                ),
                (
                    "requested_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When request was submitted",
                    ),
                ),
                (
                    "expires_at",
                    models.DateTimeField(
                        db_index=True, help_text="When request expires if not reviewed"
                    ),
                ),
                (
                    "response_time_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Minutes from request to response",
                        null=True,
                    ),
                ),
                (
                    "supervisor_notified",
                    models.BooleanField(
                        default=False, help_text="Whether supervisor was notified"
                    ),
                ),
                (
                    "supervisor_notified_at",
                    models.DateTimeField(
                        blank=True, help_text="When supervisor was notified", null=True
                    ),
                ),
                (
                    "requester_notified_of_decision",
                    models.BooleanField(
                        default=False,
                        help_text="Whether requester was notified of decision",
                    ),
                ),
                (
                    "request_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Extensible metadata (GPS, device, validation details, etc.)",
                    ),
                ),
            ],
            options={
                "verbose_name": "Approval Request",
                "verbose_name_plural": "Approval Requests",
                "db_table": "attendance_approval_request",
                "ordering": ["-requested_at"],
                "abstract": False,
            },
            bases=(
                apps.attendance.models.approval_request_actions.ApprovalRequestActions,
                models.Model,
            ),
        ),
        migrations.CreateModel(
            name="AttendanceAccessLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True,
                        default=uuid.uuid4,
                        editable=False,
                        help_text="Unique identifier for this audit log entry",
                        unique=True,
                    ),
                ),
                (
                    "resource_type",
                    models.CharField(
                        choices=[
                            ("ATTENDANCE_RECORD", "Attendance Record"),
                            ("GEOFENCE", "Geofence"),
                            ("ATTENDANCE_PHOTO", "Attendance Photo"),
                            ("BIOMETRIC_TEMPLATE", "Biometric Template"),
                            ("AUDIT_LOG", "Audit Log"),
                        ],
                        default="ATTENDANCE_RECORD",
                        help_text="Type of resource accessed",
                        max_length=50,
                    ),
                ),
                (
                    "resource_id",
                    models.IntegerField(
                        blank=True,
                        help_text="ID of the resource accessed (for non-attendance resources)",
                        null=True,
                    ),
                ),
                (
                    "action",
                    models.CharField(
                        choices=[
                            ("VIEW", "View Record"),
                            ("CREATE", "Create Record"),
                            ("UPDATE", "Update Record"),
                            ("DELETE", "Delete Record"),
                            ("EXPORT", "Export Records"),
                            ("APPROVE", "Approve Record"),
                            ("REJECT", "Reject Record"),
                            ("LOCK", "Lock for Payroll"),
                            ("UNLOCK", "Unlock Record"),
                            ("FACE_VERIFY", "Face Recognition Verification"),
                            ("GPS_VALIDATE", "GPS Location Validation"),
                            ("BULK_UPDATE", "Bulk Update Records"),
                            ("BULK_DELETE", "Bulk Delete Records"),
                        ],
                        help_text="Action performed on the resource",
                        max_length=50,
                    ),
                ),
                (
                    "timestamp",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When the action was performed",
                    ),
                ),
                (
                    "duration_ms",
                    models.IntegerField(
                        blank=True,
                        help_text="Duration of the operation in milliseconds",
                        null=True,
                    ),
                ),
                (
                    "ip_address",
                    models.GenericIPAddressField(
                        blank=True, help_text="IP address of the client", null=True
                    ),
                ),
                (
                    "user_agent",
                    models.TextField(
                        blank=True,
                        help_text="User agent string from the request",
                        null=True,
                    ),
                ),
                (
                    "request_path",
                    models.CharField(
                        blank=True,
                        help_text="Request path (e.g., /api/v1/attendance/123/)",
                        max_length=500,
                        null=True,
                    ),
                ),
                (
                    "http_method",
                    models.CharField(
                        blank=True,
                        help_text="HTTP method (GET, POST, PUT, PATCH, DELETE)",
                        max_length=10,
                        null=True,
                    ),
                ),
                (
                    "status_code",
                    models.IntegerField(
                        blank=True,
                        help_text="HTTP status code of the response",
                        null=True,
                    ),
                ),
                (
                    "correlation_id",
                    models.CharField(
                        blank=True,
                        db_index=True,
                        help_text="Correlation ID for distributed tracing",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "old_values",
                    models.JSONField(
                        blank=True,
                        help_text="Previous values before update (for audit trail)",
                        null=True,
                    ),
                ),
                (
                    "new_values",
                    models.JSONField(
                        blank=True, help_text="New values after update", null=True
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True,
                        help_text="Additional notes or context for this audit entry",
                        null=True,
                    ),
                ),
                (
                    "is_suspicious",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Flag for suspicious access patterns",
                    ),
                ),
                (
                    "risk_score",
                    models.IntegerField(
                        default=0,
                        help_text="Automated risk score (0-100) for this access",
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance Access Log",
                "verbose_name_plural": "Attendance Access Logs",
                "db_table": "attendance_access_log",
                "ordering": ["-timestamp"],
                "permissions": [
                    ("view_audit_log", "Can view attendance audit logs"),
                    ("export_audit_log", "Can export attendance audit logs"),
                    ("investigate_suspicious", "Can investigate suspicious access"),
                ],
            },
        ),
        migrations.CreateModel(
            name="AttendanceAlert",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("ACTIVE", "Active"),
                            ("ACKNOWLEDGED", "Acknowledged"),
                            ("RESOLVED", "Resolved"),
                            ("ESCALATED", "Escalated"),
                            ("AUTO_RESOLVED", "Auto-Resolved"),
                            ("CANCELLED", "Cancelled"),
                        ],
                        db_index=True,
                        default="ACTIVE",
                        help_text="Current alert status",
                        max_length=20,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("CRITICAL", "Critical"),
                            ("HIGH", "High"),
                            ("MEDIUM", "Medium"),
                            ("LOW", "Low"),
                            ("INFO", "Informational"),
                        ],
                        db_index=True,
                        help_text="Alert severity (copied from rule)",
                        max_length=10,
                    ),
                ),
                (
                    "triggered_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When alert was triggered",
                    ),
                ),
                ("title", models.CharField(help_text="Alert title", max_length=200)),
                ("message", models.TextField(help_text="Alert message/description")),
                (
                    "acknowledged_at",
                    models.DateTimeField(
                        blank=True,
                        db_index=True,
                        help_text="When alert was acknowledged",
                        null=True,
                    ),
                ),
                (
                    "acknowledgement_notes",
                    models.TextField(blank=True, help_text="Notes from acknowledger"),
                ),
                (
                    "resolved_at",
                    models.DateTimeField(
                        blank=True, help_text="When alert was resolved", null=True
                    ),
                ),
                (
                    "resolution_notes",
                    models.TextField(blank=True, help_text="How alert was resolved"),
                ),
                (
                    "escalated",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether alert was escalated",
                    ),
                ),
                (
                    "escalated_at",
                    models.DateTimeField(
                        blank=True, help_text="When alert was escalated", null=True
                    ),
                ),
                (
                    "time_to_acknowledge_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Minutes from trigger to acknowledgement",
                        null=True,
                    ),
                ),
                (
                    "time_to_resolve_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Minutes from trigger to resolution",
                        null=True,
                    ),
                ),
                (
                    "alert_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Alert context data (GPS, validation details, metrics, etc.)",
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance Alert",
                "verbose_name_plural": "Attendance Alerts",
                "db_table": "attendance_alert",
                "ordering": ["-triggered_at"],
                "abstract": False,
            },
            bases=(
                apps.attendance.models.attendance_alert_actions.AttendanceAlertActions,
                models.Model,
            ),
        ),
        migrations.CreateModel(
            name="AttendancePhoto",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True, default=uuid.uuid4, editable=False, unique=True
                    ),
                ),
                (
                    "photo_type",
                    models.CharField(
                        choices=[
                            ("CLOCK_IN", "Clock In Photo"),
                            ("CLOCK_OUT", "Clock Out Photo"),
                            ("VERIFICATION", "Additional Verification"),
                        ],
                        help_text="When photo was captured",
                        max_length=20,
                    ),
                ),
                (
                    "image",
                    models.ImageField(
                        help_text="Photo image stored in S3",
                        max_length=500,
                        upload_to="attendance_photos/%Y/%m/%d/",
                    ),
                ),
                (
                    "thumbnail",
                    models.ImageField(
                        blank=True,
                        help_text="Thumbnail version (150x150)",
                        max_length=500,
                        null=True,
                        upload_to="attendance_photos/thumbnails/%Y/%m/%d/",
                    ),
                ),
                (
                    "captured_at",
                    models.DateTimeField(
                        default=django.utils.timezone.now,
                        help_text="When photo was captured",
                    ),
                ),
                (
                    "file_size_bytes",
                    models.IntegerField(
                        blank=True, help_text="File size in bytes", null=True
                    ),
                ),
                (
                    "width",
                    models.IntegerField(
                        blank=True, help_text="Image width in pixels", null=True
                    ),
                ),
                (
                    "height",
                    models.IntegerField(
                        blank=True, help_text="Image height in pixels", null=True
                    ),
                ),
                (
                    "face_detected",
                    models.BooleanField(
                        default=False,
                        help_text="Whether a face was detected in the photo",
                    ),
                ),
                (
                    "face_count",
                    models.IntegerField(
                        default=0, help_text="Number of faces detected"
                    ),
                ),
                (
                    "face_confidence",
                    models.FloatField(
                        blank=True,
                        help_text="Face detection confidence score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "quality_score",
                    models.FloatField(
                        blank=True,
                        help_text="Overall photo quality score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "quality_rating",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("EXCELLENT", "Excellent"),
                            ("GOOD", "Good"),
                            ("ACCEPTABLE", "Acceptable"),
                            ("POOR", "Poor"),
                            ("REJECTED", "Rejected"),
                        ],
                        help_text="Photo quality rating",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "is_blurry",
                    models.BooleanField(
                        default=False, help_text="Whether photo is too blurry"
                    ),
                ),
                (
                    "is_dark",
                    models.BooleanField(
                        default=False, help_text="Whether photo is too dark"
                    ),
                ),
                (
                    "brightness",
                    models.FloatField(
                        blank=True, help_text="Brightness level (0-255)", null=True
                    ),
                ),
                (
                    "matches_enrolled_template",
                    models.BooleanField(
                        default=False,
                        help_text="Whether photo matches enrolled face template",
                    ),
                ),
                (
                    "match_confidence",
                    models.FloatField(
                        blank=True,
                        help_text="Face match confidence score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "face_recognition_model",
                    models.CharField(
                        blank=True,
                        help_text="Face recognition model used (Facenet512, VGGFace, etc.)",
                        max_length=50,
                        null=True,
                    ),
                ),
                (
                    "validation_passed",
                    models.BooleanField(
                        default=False,
                        help_text="Whether photo passed all quality checks",
                    ),
                ),
                (
                    "validation_errors",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of validation errors (if any)",
                    ),
                ),
                (
                    "device_info",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Device information (model, OS, camera specs)",
                    ),
                ),
                (
                    "gps_location",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        help_text="GPS coordinates where photo was captured",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "delete_after",
                    models.DateTimeField(
                        help_text="Auto-delete photo after this date (90-day retention)"
                    ),
                ),
                (
                    "is_deleted",
                    models.BooleanField(default=False, help_text="Soft delete flag"),
                ),
                (
                    "deleted_at",
                    models.DateTimeField(
                        blank=True, help_text="When photo was deleted", null=True
                    ),
                ),
            ],
            options={
                "verbose_name": "Attendance Photo",
                "verbose_name_plural": "Attendance Photos",
                "db_table": "attendance_photo",
                "ordering": ["-captured_at"],
            },
        ),
        migrations.CreateModel(
            name="AuditLogRetentionPolicy",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "resource_type",
                    models.CharField(
                        choices=[
                            ("ATTENDANCE_RECORD", "Attendance Record"),
                            ("GEOFENCE", "Geofence"),
                            ("ATTENDANCE_PHOTO", "Attendance Photo"),
                            ("BIOMETRIC_TEMPLATE", "Biometric Template"),
                            ("AUDIT_LOG", "Audit Log"),
                        ],
                        help_text="Type of resource this policy applies to",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "retention_days",
                    models.IntegerField(
                        default=2190, help_text="Number of days to retain audit logs"
                    ),
                ),
                (
                    "archive_after_days",
                    models.IntegerField(
                        default=730, help_text="Number of days before archiving logs"
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this policy is currently active",
                    ),
                ),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "verbose_name": "Audit Log Retention Policy",
                "verbose_name_plural": "Audit Log Retention Policies",
                "db_table": "audit_log_retention_policy",
            },
        ),
        migrations.CreateModel(
            name="AutoApprovalRule",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "rule_name",
                    models.CharField(
                        help_text="Descriptive name for this rule", max_length=100
                    ),
                ),
                (
                    "rule_code",
                    models.CharField(
                        help_text="Unique code for this rule",
                        max_length=50,
                        unique=True,
                    ),
                ),
                (
                    "active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this rule is currently active",
                    ),
                ),
                (
                    "request_types",
                    models.JSONField(
                        default=list,
                        help_text="List of request types this rule applies to",
                    ),
                ),
                (
                    "priority_levels",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="Priority levels this rule applies to (empty = all)",
                    ),
                ),
                (
                    "max_distance_from_site_meters",
                    models.IntegerField(
                        blank=True,
                        help_text="Maximum distance from site for auto-approval (meters)",
                        null=True,
                    ),
                ),
                (
                    "max_time_variance_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Maximum time variance from scheduled shift (minutes)",
                        null=True,
                    ),
                ),
                (
                    "requires_qualification_match",
                    models.BooleanField(
                        default=True,
                        help_text="Whether worker must be qualified for post",
                    ),
                ),
                (
                    "same_site_only",
                    models.BooleanField(
                        default=True, help_text="Only auto-approve if same site"
                    ),
                ),
                (
                    "conditions",
                    models.JSONField(
                        default=dict,
                        help_text="Flexible conditions in JSON format. Example: {'max_late_minutes': 15, 'allowed_sites': [1, 2], 'requires_supervisor_request': true}",
                    ),
                ),
                (
                    "description",
                    models.TextField(
                        blank=True, help_text="Description of when this rule applies"
                    ),
                ),
                (
                    "times_applied",
                    models.IntegerField(
                        default=0,
                        help_text="Number of times this rule has been applied",
                    ),
                ),
                (
                    "last_applied_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When this rule was last applied",
                        null=True,
                    ),
                ),
            ],
            options={
                "verbose_name": "Auto-Approval Rule",
                "verbose_name_plural": "Auto-Approval Rules",
                "db_table": "attendance_auto_approval_rule",
                "ordering": ["rule_name"],
                "abstract": False,
            },
            bases=(
                apps.attendance.models.auto_approval_rule_actions.AutoApprovalRuleActions,
                models.Model,
            ),
        ),
        migrations.CreateModel(
            name="ConsentPolicy",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True, default=uuid.uuid4, editable=False, unique=True
                    ),
                ),
                (
                    "policy_type",
                    models.CharField(
                        choices=[
                            ("GPS_TRACKING", "GPS Location Tracking"),
                            ("BIOMETRIC_DATA", "Biometric Data Collection"),
                            ("PHOTO_CAPTURE", "Photo Capture"),
                            ("FACE_RECOGNITION", "Face Recognition"),
                        ],
                        help_text="Type of consent being requested",
                        max_length=50,
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        choices=[
                            ("FEDERAL", "Federal (Default)"),
                            ("CA", "California"),
                            ("LA", "Louisiana"),
                            ("IL", "Illinois (BIPA)"),
                            ("TX", "Texas (CUBI)"),
                            ("WA", "Washington"),
                            ("NY", "New York"),
                        ],
                        default="FEDERAL",
                        help_text="State jurisdiction for this policy",
                        max_length=20,
                    ),
                ),
                (
                    "version",
                    models.CharField(
                        help_text="Policy version (e.g., 1.0, 2.1)", max_length=20
                    ),
                ),
                ("title", models.CharField(help_text="Policy title", max_length=255)),
                (
                    "policy_text",
                    models.TextField(help_text="Full policy text (HTML supported)"),
                ),
                (
                    "summary",
                    models.TextField(help_text="Plain language summary of the policy"),
                ),
                (
                    "effective_date",
                    models.DateField(help_text="Date this policy becomes effective"),
                ),
                (
                    "expiration_date",
                    models.DateField(
                        blank=True,
                        help_text="Date this policy expires (optional)",
                        null=True,
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this policy is currently active",
                    ),
                ),
                (
                    "requires_signature",
                    models.BooleanField(
                        default=True, help_text="Whether digital signature is required"
                    ),
                ),
                (
                    "requires_written_consent",
                    models.BooleanField(
                        default=False,
                        help_text="Whether written (not just electronic) consent is required",
                    ),
                ),
            ],
            options={
                "verbose_name": "Consent Policy",
                "verbose_name_plural": "Consent Policies",
                "db_table": "consent_policy",
                "ordering": ["-effective_date", "-version"],
            },
        ),
        migrations.CreateModel(
            name="ConsentRequirement",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "role",
                    models.CharField(
                        blank=True,
                        help_text="Apply to specific role (optional)",
                        max_length=100,
                        null=True,
                    ),
                ),
                (
                    "state",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("FEDERAL", "Federal (Default)"),
                            ("CA", "California"),
                            ("LA", "Louisiana"),
                            ("IL", "Illinois (BIPA)"),
                            ("TX", "Texas (CUBI)"),
                            ("WA", "Washington"),
                            ("NY", "New York"),
                        ],
                        help_text="Apply to employees in specific state (optional)",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "is_mandatory",
                    models.BooleanField(
                        default=True,
                        help_text="Whether consent is mandatory for matching employees",
                    ),
                ),
                (
                    "blocks_clock_in",
                    models.BooleanField(
                        default=True,
                        help_text="Whether absence of consent blocks clock-in/out",
                    ),
                ),
                (
                    "grace_period_days",
                    models.IntegerField(
                        default=0,
                        help_text="Days before consent becomes mandatory (0 = immediate)",
                    ),
                ),
                (
                    "reminder_days_before_expiration",
                    models.IntegerField(
                        default=30,
                        help_text="Days before expiration to send reminder (0 = no reminder)",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this requirement is currently active",
                    ),
                ),
            ],
            options={
                "verbose_name": "Consent Requirement",
                "verbose_name_plural": "Consent Requirements",
                "db_table": "consent_requirement",
            },
        ),
        migrations.CreateModel(
            name="EmployeeConsentLog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True, default=uuid.uuid4, editable=False, unique=True
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Review"),
                            ("GRANTED", "Consent Granted"),
                            ("REVOKED", "Consent Revoked"),
                            ("EXPIRED", "Consent Expired"),
                            ("DENIED", "Consent Denied"),
                        ],
                        default="PENDING",
                        help_text="Current consent status",
                        max_length=20,
                    ),
                ),
                (
                    "granted_at",
                    models.DateTimeField(
                        blank=True, help_text="When consent was granted", null=True
                    ),
                ),
                (
                    "granted_ip",
                    models.GenericIPAddressField(
                        blank=True,
                        help_text="IP address where consent was granted",
                        null=True,
                    ),
                ),
                (
                    "granted_user_agent",
                    models.TextField(
                        blank=True,
                        help_text="User agent when consent was granted",
                        null=True,
                    ),
                ),
                (
                    "signature_data",
                    models.TextField(
                        blank=True,
                        help_text="Digital signature data (base64 encoded image or typed name)",
                        null=True,
                    ),
                ),
                (
                    "signature_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("TYPED", "Typed Name"),
                            ("DRAWN", "Drawn Signature"),
                            ("ELECTRONIC", "Electronic Acceptance"),
                        ],
                        help_text="Type of signature provided",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "written_consent_document",
                    models.FileField(
                        blank=True,
                        help_text="Scanned written consent document (if required)",
                        null=True,
                        upload_to="consent_documents/%Y/%m/",
                    ),
                ),
                (
                    "revoked_at",
                    models.DateTimeField(
                        blank=True, help_text="When consent was revoked", null=True
                    ),
                ),
                (
                    "revoked_reason",
                    models.TextField(
                        blank=True, help_text="Reason for consent revocation", null=True
                    ),
                ),
                (
                    "revoked_ip",
                    models.GenericIPAddressField(
                        blank=True,
                        help_text="IP address where consent was revoked",
                        null=True,
                    ),
                ),
                (
                    "expires_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When consent expires (optional)",
                        null=True,
                    ),
                ),
                (
                    "notification_sent_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When notification email was sent",
                        null=True,
                    ),
                ),
                (
                    "reminder_sent_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When reminder was sent (for pending consents)",
                        null=True,
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Additional notes or context", null=True
                    ),
                ),
            ],
            options={
                "verbose_name": "Employee Consent Log",
                "verbose_name_plural": "Employee Consent Logs",
                "db_table": "employee_consent_log",
                "ordering": ["-granted_at", "-cdtz"],
            },
        ),
        migrations.CreateModel(
            name="FraudAlert",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True, default=uuid.uuid4, editable=False, unique=True
                    ),
                ),
                (
                    "alert_type",
                    models.CharField(
                        choices=[
                            ("BUDDY_PUNCHING", "Buddy Punching"),
                            ("GPS_SPOOFING", "GPS Spoofing"),
                            ("IMPOSSIBLE_TRAVEL", "Impossible Travel"),
                            ("DEVICE_SHARING", "Device Sharing"),
                            ("UNUSUAL_PATTERN", "Unusual Pattern"),
                            ("BIOMETRIC_MISMATCH", "Biometric Mismatch"),
                            ("TEMPORAL_ANOMALY", "Temporal Anomaly"),
                            ("HIGH_RISK_BEHAVIOR", "High Risk Behavior"),
                        ],
                        max_length=50,
                    ),
                ),
                (
                    "severity",
                    models.CharField(
                        choices=[
                            ("LOW", "Low"),
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("CRITICAL", "Critical"),
                        ],
                        max_length=20,
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("PENDING", "Pending Review"),
                            ("INVESTIGATING", "Under Investigation"),
                            ("RESOLVED_LEGITIMATE", "Resolved - Legitimate"),
                            ("RESOLVED_FRAUD", "Resolved - Fraud Confirmed"),
                            ("FALSE_POSITIVE", "False Positive"),
                            ("ESCALATED", "Escalated"),
                        ],
                        default="PENDING",
                        max_length=30,
                    ),
                ),
                (
                    "fraud_score",
                    models.FloatField(help_text="Fraud detection score (0-1)"),
                ),
                ("risk_score", models.IntegerField(help_text="Risk score (0-100)")),
                (
                    "detection_timestamp",
                    models.DateTimeField(default=django.utils.timezone.now),
                ),
                (
                    "evidence",
                    models.JSONField(help_text="Evidence and anomaly details"),
                ),
                ("anomalies_detected", models.JSONField(default=list)),
                ("assigned_at", models.DateTimeField(blank=True, null=True)),
                ("resolved_at", models.DateTimeField(blank=True, null=True)),
                ("investigation_notes", models.TextField(blank=True)),
                ("resolution_notes", models.TextField(blank=True)),
                (
                    "auto_blocked",
                    models.BooleanField(
                        default=False, help_text="Was attendance auto-blocked"
                    ),
                ),
                ("manager_notified", models.BooleanField(default=False)),
                ("employee_notified", models.BooleanField(default=False)),
                ("is_escalated", models.BooleanField(default=False)),
                ("escalated_at", models.DateTimeField(blank=True, null=True)),
                ("escalation_reason", models.TextField(blank=True)),
            ],
            options={
                "verbose_name": "Fraud Alert",
                "verbose_name_plural": "Fraud Alerts",
                "db_table": "fraud_alert",
                "ordering": ["-detection_timestamp"],
            },
        ),
        migrations.CreateModel(
            name="Geofence",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                ("name", models.CharField(help_text="Geofence name", max_length=255)),
                (
                    "geofence_type",
                    models.CharField(
                        choices=[("polygon", "Polygon"), ("circle", "Circle")],
                        default="polygon",
                        max_length=20,
                    ),
                ),
                (
                    "boundary",
                    django.contrib.gis.db.models.fields.PolygonField(
                        blank=True, null=True, srid=4326
                    ),
                ),
                (
                    "center_point",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True, null=True, srid=4326
                    ),
                ),
                ("radius", models.FloatField(blank=True, null=True)),
                (
                    "hysteresis_meters",
                    models.FloatField(
                        default=1.0,
                        help_text="Buffer zone in meters to prevent boundary flapping (configurable per geofence)",
                    ),
                ),
                ("is_active", models.BooleanField(default=True)),
                ("description", models.TextField(blank=True)),
                ("tenant", models.CharField(default="default", max_length=100)),
            ],
            options={
                "db_table": "geofence",
            },
        ),
        migrations.CreateModel(
            name="PeopleEventlog",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                ("uuid", models.UUIDField(blank=True, default=uuid.uuid4, unique=True)),
                (
                    "transportmodes",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(
                            blank=True,
                            choices=[
                                ("BIKE", "Bike"),
                                ("RICKSHAW", "Rickshaw"),
                                ("BUS", "Bus"),
                                ("TRAIN", "Train"),
                                ("TRAM", "Tram"),
                                ("PLANE", "Plane"),
                                ("FERRY", "Ferry"),
                                ("NONE", "NONE"),
                                ("CAR", "Car"),
                                ("TAXI", "Taxi"),
                                ("OLA_UBER", "Ola/Uber"),
                            ],
                            default="NONE",
                            max_length=50,
                        ),
                        default=list,
                        size=None,
                    ),
                ),
                ("punchintime", models.DateTimeField(null=True, verbose_name="In")),
                ("punchouttime", models.DateTimeField(null=True, verbose_name="Out")),
                ("datefor", models.DateField(null=True, verbose_name="Date")),
                (
                    "distance",
                    models.FloatField(blank=True, null=True, verbose_name="Distance"),
                ),
                (
                    "duration",
                    models.IntegerField(blank=True, null=True, verbose_name="Duration"),
                ),
                (
                    "expamt",
                    models.FloatField(
                        blank=True, default=0.0, null=True, verbose_name="exampt"
                    ),
                ),
                (
                    "accuracy",
                    models.FloatField(blank=True, null=True, verbose_name="accuracy"),
                ),
                (
                    "deviceid",
                    models.CharField(
                        blank=True, max_length=50, null=True, verbose_name="deviceid"
                    ),
                ),
                (
                    "startlocation",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        null=True,
                        srid=4326,
                        verbose_name="GPS-In",
                    ),
                ),
                (
                    "endlocation",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        null=True,
                        srid=4326,
                        verbose_name="GPS-Out",
                    ),
                ),
                (
                    "journeypath",
                    django.contrib.gis.db.models.fields.LineStringField(
                        blank=True, geography=True, null=True, srid=4326
                    ),
                ),
                (
                    "remarks",
                    models.CharField(
                        blank=True, max_length=500, null=True, verbose_name="remarks"
                    ),
                ),
                (
                    "facerecognitionin",
                    models.BooleanField(
                        blank=True,
                        default=False,
                        null=True,
                        verbose_name="Enable Face-Recognition In",
                    ),
                ),
                (
                    "facerecognitionout",
                    models.BooleanField(
                        blank=True,
                        default=False,
                        null=True,
                        verbose_name="Enable Face-Recognition Out",
                    ),
                ),
                (
                    "peventlogextras",
                    apps.core.fields.encrypted_json_field.EncryptedJSONField(
                        default=apps.attendance.models.people_eventlog.peventlog_json,
                        help_text="Encrypted JSON field for face recognition, geofence, and verification data (biometric templates)",
                        verbose_name="peventlogextras",
                    ),
                ),
                (
                    "otherlocation",
                    models.CharField(
                        max_length=50, null=True, verbose_name="Other Location"
                    ),
                ),
                (
                    "reference",
                    models.CharField(
                        max_length=55, null=True, verbose_name="Reference"
                    ),
                ),
                (
                    "geojson",
                    models.JSONField(
                        blank=True,
                        default=apps.attendance.models.people_eventlog.pel_geojson,
                        null=True,
                    ),
                ),
                (
                    "fraud_score",
                    models.FloatField(
                        blank=True,
                        db_index=True,
                        help_text="Fraud detection composite score (0-1)",
                        null=True,
                    ),
                ),
                (
                    "fraud_risk_level",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("MINIMAL", "Minimal"),
                            ("LOW", "Low"),
                            ("MEDIUM", "Medium"),
                            ("HIGH", "High"),
                            ("CRITICAL", "Critical"),
                        ],
                        help_text="Fraud risk level determined by ML models",
                        max_length=20,
                        null=True,
                    ),
                ),
                (
                    "fraud_anomalies",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of detected fraud anomalies with details",
                    ),
                ),
                (
                    "fraud_analyzed_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When fraud analysis was performed",
                        null=True,
                    ),
                ),
                (
                    "is_archived",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether record has been archived (>2 years old)",
                    ),
                ),
                (
                    "archived_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When record was moved to archive",
                        null=True,
                    ),
                ),
                (
                    "gps_purged",
                    models.BooleanField(
                        default=False,
                        help_text="Whether GPS location data has been purged (>90 days)",
                    ),
                ),
                (
                    "gps_purged_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When GPS data was purged for privacy compliance",
                        null=True,
                    ),
                ),
                (
                    "version",
                    concurrency.fields.VersionField(
                        default=0, help_text="record revision number"
                    ),
                ),
            ],
            options={
                "verbose_name": "People Event Log",
                "verbose_name_plural": "People Event Logs",
                "db_table": "peopleeventlog",
                "ordering": ["mdtz"],
                "abstract": False,
            },
            managers=[
                ("objects", apps.attendance.managers.PELManager()),
            ],
        ),
        migrations.CreateModel(
            name="PhotoQualityThreshold",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "min_quality_score",
                    models.FloatField(
                        default=0.5, help_text="Minimum quality score (0-1)"
                    ),
                ),
                (
                    "min_width",
                    models.IntegerField(
                        default=480, help_text="Minimum image width in pixels"
                    ),
                ),
                (
                    "min_height",
                    models.IntegerField(
                        default=480, help_text="Minimum image height in pixels"
                    ),
                ),
                (
                    "max_file_size_kb",
                    models.IntegerField(
                        default=200, help_text="Maximum file size in kilobytes"
                    ),
                ),
                (
                    "require_face_detection",
                    models.BooleanField(
                        default=True, help_text="Whether face must be detected in photo"
                    ),
                ),
                (
                    "min_face_confidence",
                    models.FloatField(
                        default=0.8, help_text="Minimum face detection confidence (0-1)"
                    ),
                ),
                (
                    "max_blur_threshold",
                    models.FloatField(
                        default=100.0,
                        help_text="Maximum acceptable blur (Laplacian variance)",
                    ),
                ),
                (
                    "min_brightness",
                    models.IntegerField(
                        default=50, help_text="Minimum brightness level (0-255)"
                    ),
                ),
                (
                    "max_brightness",
                    models.IntegerField(
                        default=220, help_text="Maximum brightness level (0-255)"
                    ),
                ),
                (
                    "photo_required_clock_in",
                    models.BooleanField(
                        default=True, help_text="Whether photo is required for clock-in"
                    ),
                ),
                (
                    "photo_required_clock_out",
                    models.BooleanField(
                        default=False,
                        help_text="Whether photo is required for clock-out",
                    ),
                ),
                (
                    "is_active",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this threshold configuration is active",
                    ),
                ),
            ],
            options={
                "verbose_name": "Photo Quality Threshold",
                "verbose_name_plural": "Photo Quality Thresholds",
                "db_table": "photo_quality_threshold",
            },
        ),
        migrations.CreateModel(
            name="Post",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "post_code",
                    models.CharField(
                        db_index=True,
                        help_text="Unique post code (e.g., 'POST-001', 'GATE-A')",
                        max_length=20,
                    ),
                ),
                (
                    "post_name",
                    models.CharField(
                        help_text="Descriptive post name (e.g., 'Main Gate - Morning Shift')",
                        max_length=100,
                    ),
                ),
                (
                    "post_type",
                    models.CharField(
                        choices=[
                            ("GATE", "Gate"),
                            ("PERIMETER", "Perimeter"),
                            ("ENTRY_EXIT", "Entry/Exit Point"),
                            ("VAULT", "Vault"),
                            ("ATM", "ATM"),
                            ("CONTROL_ROOM", "Control Room"),
                            ("PARKING", "Parking Area"),
                            ("LOADING_DOCK", "Loading Dock"),
                            ("EMERGENCY_EXIT", "Emergency Exit"),
                            ("ASSET_STORAGE", "Asset Storage"),
                            ("CASH_COUNTER", "Cash Counter"),
                            ("SERVER_ROOM", "Server Room"),
                            ("RECEPTION", "Reception"),
                            ("LOBBY", "Lobby"),
                            ("ROOFTOP", "Rooftop"),
                            ("OTHER", "Other"),
                        ],
                        db_index=True,
                        default="OTHER",
                        help_text="Type of duty station",
                        max_length=20,
                    ),
                ),
                (
                    "required_guard_count",
                    models.IntegerField(
                        default=1,
                        help_text="Number of guards required at this post simultaneously",
                        validators=[
                            django.core.validators.MinValueValidator(0),
                            django.core.validators.MaxValueValidator(10),
                        ],
                    ),
                ),
                (
                    "armed_required",
                    models.BooleanField(
                        default=False,
                        help_text="Whether guards at this post must be armed",
                    ),
                ),
                (
                    "gps_coordinates",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True,
                        geography=True,
                        help_text="GPS coordinates of post location (center point)",
                        null=True,
                        srid=4326,
                    ),
                ),
                (
                    "geofence_radius",
                    models.IntegerField(
                        default=50,
                        help_text="Radius in meters for circular geofence (if no explicit geofence)",
                        validators=[
                            django.core.validators.MinValueValidator(10),
                            django.core.validators.MaxValueValidator(500),
                        ],
                    ),
                ),
                (
                    "floor_level",
                    models.CharField(
                        blank=True,
                        help_text="Floor level (e.g., 'Ground Floor', 'Level 2', 'Basement')",
                        max_length=20,
                    ),
                ),
                (
                    "building_section",
                    models.CharField(
                        blank=True,
                        help_text="Building section (e.g., 'Tower A', 'North Wing')",
                        max_length=50,
                    ),
                ),
                (
                    "post_orders",
                    models.TextField(
                        blank=True,
                        help_text="Digital post orders - detailed instructions for guards at this post",
                    ),
                ),
                (
                    "post_orders_version",
                    models.IntegerField(
                        default=1, help_text="Version number for post orders tracking"
                    ),
                ),
                (
                    "post_orders_last_updated",
                    models.DateTimeField(
                        auto_now=True, help_text="When post orders were last modified"
                    ),
                ),
                (
                    "duties_summary",
                    models.TextField(
                        blank=True, help_text="Brief summary of duties (bullet points)"
                    ),
                ),
                (
                    "emergency_procedures",
                    models.TextField(
                        blank=True, help_text="Emergency procedures for this post"
                    ),
                ),
                (
                    "reporting_instructions",
                    models.TextField(
                        blank=True, help_text="How and when to report from this post"
                    ),
                ),
                (
                    "risk_level",
                    models.CharField(
                        choices=[
                            ("CRITICAL", "Critical"),
                            ("HIGH", "High"),
                            ("MEDIUM", "Medium"),
                            ("LOW", "Low"),
                            ("MINIMAL", "Minimal"),
                        ],
                        db_index=True,
                        default="MEDIUM",
                        help_text="Security risk level for this post",
                        max_length=20,
                    ),
                ),
                (
                    "high_value_assets",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this post protects high-value assets",
                    ),
                ),
                (
                    "public_access",
                    models.BooleanField(
                        default=False, help_text="Whether this post has public access"
                    ),
                ),
                (
                    "active",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this post is currently active",
                    ),
                ),
                (
                    "coverage_required",
                    models.BooleanField(
                        default=True,
                        help_text="Whether this post must be covered at all times",
                    ),
                ),
                (
                    "temporary",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this is a temporary post (event-based)",
                    ),
                ),
                (
                    "temporary_start_date",
                    models.DateField(
                        blank=True,
                        help_text="Start date for temporary posts",
                        null=True,
                    ),
                ),
                (
                    "temporary_end_date",
                    models.DateField(
                        blank=True, help_text="End date for temporary posts", null=True
                    ),
                ),
                (
                    "post_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Extensible metadata for post-specific data (equipment, access codes, special instructions)",
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Additional notes about this post"
                    ),
                ),
            ],
            options={
                "verbose_name": "Post",
                "verbose_name_plural": "Posts",
                "db_table": "attendance_post",
                "ordering": ["site", "shift", "post_code"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="PostAssignment",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "assignment_date",
                    models.DateField(db_index=True, help_text="Date of assignment"),
                ),
                (
                    "start_time",
                    models.TimeField(
                        help_text="Shift start time (can differ from shift.starttime for ad-hoc)"
                    ),
                ),
                (
                    "end_time",
                    models.TimeField(
                        help_text="Shift end time (can differ from shift.endtime for ad-hoc)"
                    ),
                ),
                (
                    "status",
                    models.CharField(
                        choices=[
                            ("SCHEDULED", "Scheduled"),
                            ("CONFIRMED", "Worker Confirmed"),
                            ("IN_PROGRESS", "On Duty"),
                            ("COMPLETED", "Shift Completed"),
                            ("NO_SHOW", "No Show"),
                            ("CANCELLED", "Cancelled"),
                            ("REPLACED", "Replaced by Another Worker"),
                        ],
                        db_index=True,
                        default="SCHEDULED",
                        help_text="Current status of assignment",
                        max_length=20,
                    ),
                ),
                (
                    "status_updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="When status was last updated"
                    ),
                ),
                (
                    "confirmed_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When worker confirmed they will attend",
                        null=True,
                    ),
                ),
                (
                    "checked_in_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When worker checked in at post",
                        null=True,
                    ),
                ),
                (
                    "checked_out_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When worker checked out from post",
                        null=True,
                    ),
                ),
                (
                    "approval_required",
                    models.BooleanField(
                        default=False,
                        help_text="Whether this assignment requires manager approval",
                    ),
                ),
                (
                    "approved_at",
                    models.DateTimeField(
                        blank=True, help_text="When assignment was approved", null=True
                    ),
                ),
                (
                    "approval_notes",
                    models.TextField(blank=True, help_text="Notes from approver"),
                ),
                (
                    "is_override",
                    models.BooleanField(
                        db_index=True,
                        default=False,
                        help_text="Whether this is an override assignment (emergency, replacement, validation bypass)",
                    ),
                ),
                (
                    "override_reason",
                    models.TextField(
                        blank=True,
                        help_text="Reason for override (required if is_override=True)",
                    ),
                ),
                (
                    "override_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("EMERGENCY", "Emergency"),
                            ("REPLACEMENT", "Worker Replacement"),
                            ("VALIDATION_BYPASS", "Validation Check-in Bypass"),
                            ("SCHEDULE_CHANGE", "Last-Minute Schedule Change"),
                            ("COVERAGE_GAP", "Coverage Gap Fill"),
                            ("OTHER", "Other"),
                        ],
                        help_text="Type of override",
                        max_length=50,
                    ),
                ),
                (
                    "post_orders_acknowledged",
                    models.BooleanField(
                        default=False,
                        help_text="Whether worker has acknowledged post orders",
                    ),
                ),
                (
                    "post_orders_version_acknowledged",
                    models.IntegerField(
                        blank=True,
                        help_text="Version of post orders that was acknowledged",
                        null=True,
                    ),
                ),
                (
                    "post_orders_acknowledged_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When post orders were acknowledged",
                        null=True,
                    ),
                ),
                (
                    "on_time_checkin",
                    models.BooleanField(
                        default=False,
                        help_text="Whether worker checked in on time (within grace period)",
                    ),
                ),
                (
                    "late_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Minutes late for check-in (negative if early)",
                        null=True,
                    ),
                ),
                (
                    "hours_worked",
                    models.DecimalField(
                        blank=True,
                        decimal_places=2,
                        help_text="Actual hours worked (calculated from check-in/out)",
                        max_digits=5,
                        null=True,
                    ),
                ),
                (
                    "assignment_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Extensible metadata (special instructions, equipment, access codes)",
                    ),
                ),
                (
                    "notes",
                    models.TextField(
                        blank=True, help_text="Additional notes about this assignment"
                    ),
                ),
                (
                    "worker_notified",
                    models.BooleanField(
                        default=False,
                        help_text="Whether worker was notified of assignment",
                    ),
                ),
                (
                    "worker_notified_at",
                    models.DateTimeField(
                        blank=True, help_text="When worker was notified", null=True
                    ),
                ),
                (
                    "reminder_sent",
                    models.BooleanField(
                        default=False,
                        help_text="Whether reminder was sent before shift",
                    ),
                ),
                (
                    "reminder_sent_at",
                    models.DateTimeField(
                        blank=True, help_text="When reminder was sent", null=True
                    ),
                ),
            ],
            options={
                "verbose_name": "Post Assignment",
                "verbose_name_plural": "Post Assignments",
                "db_table": "attendance_post_assignment",
                "ordering": ["assignment_date", "start_time", "site", "post"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="PostOrderAcknowledgement",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When this record was created",
                        verbose_name="Created at",
                    ),
                ),
                (
                    "updated_at",
                    models.DateTimeField(
                        auto_now=True,
                        help_text="When this record was last modified",
                        verbose_name="Updated at",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "post_orders_version",
                    models.IntegerField(
                        help_text="Version of post orders that was acknowledged"
                    ),
                ),
                (
                    "post_orders_content_hash",
                    models.CharField(
                        blank=True,
                        help_text="SHA-256 hash of post orders content for integrity verification",
                        max_length=64,
                    ),
                ),
                (
                    "acknowledged_at",
                    models.DateTimeField(
                        db_index=True,
                        default=django.utils.timezone.now,
                        help_text="When post orders were acknowledged",
                    ),
                ),
                (
                    "acknowledgement_date",
                    models.DateField(
                        auto_now_add=True,
                        db_index=True,
                        help_text="Date of acknowledgement (for daily queries)",
                    ),
                ),
                (
                    "device_id",
                    models.CharField(
                        blank=True,
                        help_text="Device ID where acknowledgement occurred",
                        max_length=100,
                    ),
                ),
                (
                    "ip_address",
                    models.GenericIPAddressField(
                        blank=True,
                        help_text="IP address where acknowledgement occurred",
                        null=True,
                    ),
                ),
                (
                    "user_agent",
                    models.CharField(
                        blank=True, help_text="Browser/app user agent", max_length=255
                    ),
                ),
                (
                    "gps_location",
                    models.JSONField(
                        blank=True,
                        help_text="GPS location where acknowledgement occurred {'lat': float, 'lng': float}",
                        null=True,
                    ),
                ),
                (
                    "acknowledgement_method",
                    models.CharField(
                        choices=[
                            ("mobile_app", "Mobile App"),
                            ("web_portal", "Web Portal"),
                            ("paper_signed", "Paper Form (Digitized)"),
                            ("verbal_confirmed", "Verbal Confirmation (Documented)"),
                            ("auto_assigned", "Auto-assigned (System)"),
                        ],
                        default="mobile_app",
                        help_text="How acknowledgement was obtained",
                        max_length=50,
                    ),
                ),
                (
                    "time_to_acknowledge_seconds",
                    models.IntegerField(
                        blank=True,
                        help_text="Seconds spent reading post orders before acknowledging",
                        null=True,
                    ),
                ),
                (
                    "minimum_read_time_met",
                    models.BooleanField(
                        default=True,
                        help_text="Whether minimum required reading time was met",
                    ),
                ),
                (
                    "quiz_taken",
                    models.BooleanField(
                        default=False, help_text="Whether comprehension quiz was taken"
                    ),
                ),
                (
                    "quiz_score",
                    models.IntegerField(
                        blank=True, help_text="Quiz score (0-100)", null=True
                    ),
                ),
                (
                    "quiz_passed",
                    models.BooleanField(
                        default=False, help_text="Whether quiz was passed"
                    ),
                ),
                (
                    "quiz_results",
                    models.JSONField(
                        blank=True, help_text="Detailed quiz results", null=True
                    ),
                ),
                (
                    "digital_signature",
                    models.TextField(
                        blank=True,
                        help_text="Digital signature data (base64 encoded image or signature string)",
                    ),
                ),
                (
                    "signature_verified",
                    models.BooleanField(
                        default=False, help_text="Whether signature was verified"
                    ),
                ),
                (
                    "acknowledgement_statement",
                    models.TextField(
                        default="I have read and understood the post orders for this duty station.",
                        help_text="Statement that worker acknowledged",
                    ),
                ),
                (
                    "worker_comments",
                    models.TextField(
                        blank=True, help_text="Optional comments from worker"
                    ),
                ),
                (
                    "valid_from",
                    models.DateTimeField(
                        default=django.utils.timezone.now,
                        help_text="When this acknowledgement becomes valid",
                    ),
                ),
                (
                    "valid_until",
                    models.DateTimeField(
                        blank=True,
                        help_text="When this acknowledgement expires (null = indefinite)",
                        null=True,
                    ),
                ),
                (
                    "is_valid",
                    models.BooleanField(
                        db_index=True,
                        default=True,
                        help_text="Whether this acknowledgement is currently valid",
                    ),
                ),
                (
                    "supervisor_verified",
                    models.BooleanField(
                        default=False,
                        help_text="Whether supervisor verified this acknowledgement",
                    ),
                ),
                (
                    "verified_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When acknowledgement was verified",
                        null=True,
                    ),
                ),
                (
                    "acknowledgement_metadata",
                    models.JSONField(
                        blank=True,
                        default=dict,
                        help_text="Extensible metadata for acknowledgement tracking",
                    ),
                ),
            ],
            options={
                "verbose_name": "Post Order Acknowledgement",
                "verbose_name_plural": "Post Order Acknowledgements",
                "db_table": "attendance_post_order_acknowledgement",
                "ordering": ["-acknowledged_at"],
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="SyncConflict",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(default=uuid.uuid4, editable=False, unique=True),
                ),
                (
                    "conflict_type",
                    models.CharField(
                        choices=[
                            ("CONCURRENT_UPDATE", "Concurrent Update"),
                            ("VERSION_MISMATCH", "Version Mismatch"),
                            ("DATA_CORRUPTION", "Data Corruption"),
                            ("TIMESTAMP_CONFLICT", "Timestamp Conflict"),
                        ],
                        max_length=50,
                    ),
                ),
                (
                    "detected_at",
                    models.DateTimeField(default=django.utils.timezone.now),
                ),
                (
                    "client_version",
                    models.JSONField(help_text="Client's version of the data"),
                ),
                (
                    "server_version",
                    models.JSONField(help_text="Server's version of the data"),
                ),
                (
                    "resolution",
                    models.CharField(
                        choices=[
                            ("SERVER_WINS", "Server Wins"),
                            ("CLIENT_WINS", "Client Wins"),
                            ("MERGED", "Merged"),
                            ("MANUAL", "Manual Resolution"),
                        ],
                        max_length=20,
                    ),
                ),
                ("resolved_at", models.DateTimeField(auto_now_add=True)),
                ("user_notified", models.BooleanField(default=False)),
                ("notification_sent_at", models.DateTimeField(blank=True, null=True)),
                ("device_id", models.CharField(blank=True, max_length=100)),
                ("app_version", models.CharField(blank=True, max_length=20)),
            ],
            options={
                "verbose_name": "Sync Conflict",
                "verbose_name_plural": "Sync Conflicts",
                "db_table": "sync_conflict",
            },
        ),
        migrations.CreateModel(
            name="TestGeo",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("code", models.CharField(max_length=15)),
                (
                    "poly",
                    django.contrib.gis.db.models.fields.PolygonField(
                        geography=True, null=True, srid=4326
                    ),
                ),
                (
                    "point",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True, geography=True, null=True, srid=4326
                    ),
                ),
                (
                    "line",
                    django.contrib.gis.db.models.fields.LineStringField(
                        blank=True, geography=True, null=True, srid=4326
                    ),
                ),
            ],
        ),
        migrations.CreateModel(
            name="Tracking",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                ("uuid", models.UUIDField(blank=True, default=uuid.uuid4, unique=True)),
                ("deviceid", models.CharField(max_length=40)),
                (
                    "gpslocation",
                    django.contrib.gis.db.models.fields.PointField(
                        blank=True, geography=True, null=True, srid=4326
                    ),
                ),
                ("receiveddate", models.DateTimeField(null=True)),
                ("transportmode", models.CharField(max_length=55)),
                ("reference", models.CharField(default=None, max_length=255)),
                (
                    "identifier",
                    models.CharField(
                        choices=[
                            ("NONE", "None"),
                            ("CONVEYANCE", "Conveyance"),
                            ("EXTERNALTOUR", "External Tour"),
                            ("INTERNALTOUR", "Internal Tour"),
                            ("SITEVISIT", "Site Visit"),
                            ("TRACKING", "Tracking"),
                        ],
                        default="NONE",
                        max_length=55,
                    ),
                ),
            ],
            options={
                "db_table": "tracking",
            },
        ),
        migrations.CreateModel(
            name="UserBehaviorProfile",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "cdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was created",
                        verbose_name="Created date",
                    ),
                ),
                (
                    "mdtz",
                    models.DateTimeField(
                        default=apps.peoples.models.base_model.now,
                        help_text="When this record was last modified",
                        verbose_name="Modified date",
                    ),
                ),
                (
                    "ctzoffset",
                    models.IntegerField(
                        default=-1,
                        help_text="User's timezone offset in minutes",
                        verbose_name="Timezone offset",
                    ),
                ),
                (
                    "uuid",
                    models.UUIDField(
                        db_index=True, default=uuid.uuid4, editable=False, unique=True
                    ),
                ),
                (
                    "baseline_created_at",
                    models.DateTimeField(
                        auto_now_add=True,
                        help_text="When baseline was first established",
                    ),
                ),
                (
                    "baseline_updated_at",
                    models.DateTimeField(
                        auto_now=True, help_text="When baseline was last updated"
                    ),
                ),
                (
                    "training_records_count",
                    models.IntegerField(
                        default=0,
                        help_text="Number of attendance records used to train baseline",
                    ),
                ),
                (
                    "is_baseline_sufficient",
                    models.BooleanField(
                        default=False,
                        help_text="Whether enough data exists for reliable detection (30+ records)",
                    ),
                ),
                (
                    "typical_checkin_hour",
                    models.IntegerField(
                        blank=True,
                        help_text="Most common check-in hour (0-23)",
                        null=True,
                    ),
                ),
                (
                    "typical_checkin_minute",
                    models.IntegerField(
                        blank=True,
                        help_text="Most common check-in minute (0-59)",
                        null=True,
                    ),
                ),
                (
                    "checkin_time_variance_minutes",
                    models.IntegerField(
                        default=30,
                        help_text="Acceptable variance in check-in time (minutes)",
                    ),
                ),
                (
                    "typical_checkout_hour",
                    models.IntegerField(
                        blank=True,
                        help_text="Most common check-out hour (0-23)",
                        null=True,
                    ),
                ),
                (
                    "typical_work_duration_minutes",
                    models.IntegerField(
                        blank=True,
                        help_text="Typical shift duration in minutes",
                        null=True,
                    ),
                ),
                (
                    "work_duration_variance_minutes",
                    models.IntegerField(
                        default=60, help_text="Acceptable variance in shift duration"
                    ),
                ),
                (
                    "typical_locations",
                    models.JSONField(
                        blank=True,
                        default=list,
                        help_text="List of typical check-in locations (lat, lng, frequency)",
                    ),
                ),
                (
                    "typical_geofences",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.IntegerField(),
                        blank=True,
                        default=list,
                        help_text="List of typical geofence IDs",
                        size=None,
                    ),
                ),
                (
                    "location_radius_meters",
                    models.FloatField(
                        default=500.0,
                        help_text="Typical radius from usual locations (meters)",
                    ),
                ),
                (
                    "typical_devices",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=100),
                        blank=True,
                        default=list,
                        help_text="List of typical device IDs",
                        size=None,
                    ),
                ),
                (
                    "device_change_tolerance",
                    models.IntegerField(
                        default=2,
                        help_text="Number of new devices before flagging as suspicious",
                    ),
                ),
                (
                    "typical_work_days",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.IntegerField(),
                        blank=True,
                        default=list,
                        help_text="Typical work days (1=Monday, 7=Sunday)",
                        size=None,
                    ),
                ),
                (
                    "typical_transport_modes",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(max_length=50),
                        blank=True,
                        default=list,
                        help_text="Typical transport modes",
                        size=None,
                    ),
                ),
                (
                    "anomaly_score_threshold",
                    models.FloatField(
                        default=0.7,
                        help_text="Threshold for flagging anomalous behavior (0-1)",
                    ),
                ),
                (
                    "auto_block_threshold",
                    models.FloatField(
                        default=0.9,
                        help_text="Threshold for auto-blocking suspicious activity (0-1)",
                    ),
                ),
                (
                    "total_checkins",
                    models.IntegerField(
                        default=0, help_text="Total number of check-ins analyzed"
                    ),
                ),
                (
                    "anomalies_detected",
                    models.IntegerField(
                        default=0, help_text="Number of anomalies detected"
                    ),
                ),
                (
                    "false_positives",
                    models.IntegerField(
                        default=0,
                        help_text="Number of false positives (anomalies marked as normal by manager)",
                    ),
                ),
                (
                    "detection_accuracy",
                    models.FloatField(
                        blank=True,
                        help_text="Detection accuracy based on manager feedback (0-1)",
                        null=True,
                    ),
                ),
                (
                    "last_anomaly_at",
                    models.DateTimeField(
                        blank=True,
                        help_text="When last anomaly was detected",
                        null=True,
                    ),
                ),
            ],
            options={
                "verbose_name": "User Behavior Profile",
                "verbose_name_plural": "User Behavior Profiles",
                "db_table": "user_behavior_profile",
            },
        ),
    ]
