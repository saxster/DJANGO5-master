# Generated by Claude Code on 2025-11-04
# Performance optimization: Phase 1 - Performance Engineer

from django.db import migrations, models


class Migration(migrations.Migration):
    """
    Add composite indexes for Tracking model query optimization.

    These indexes significantly improve performance for:
    - People tracking queries (people + receiveddate): Common for user history lookups
    - Identifier-based tracking (identifier + receiveddate): Filter by tracking type with time range
    - Device-based queries (deviceid): Device-specific tracking history

    Related: Phase 1 Performance Remediation - Critical Performance Issues
    """

    dependencies = [
        ('attendance', '0030_add_performance_indexes_post_assignment'),
    ]

    operations = [
        # Index for people-based tracking queries with date filtering
        # Used by: Personnel tracking history, conveyance reports
        migrations.AddIndex(
            model_name='tracking',
            index=models.Index(
                fields=['people', 'receiveddate'],
                name='tracking_people_date_idx'
            ),
        ),

        # Index for identifier-based tracking queries with date filtering
        # Used by: Conveyance tracking, tour tracking, site visit tracking
        migrations.AddIndex(
            model_name='tracking',
            index=models.Index(
                fields=['identifier', 'receiveddate'],
                name='tracking_ident_date_idx'
            ),
        ),

        # Index for device-based tracking queries
        # Used by: Device history lookups, debugging tracking issues
        migrations.AddIndex(
            model_name='tracking',
            index=models.Index(
                fields=['deviceid'],
                name='tracking_device_idx'
            ),
        ),
    ]
