#!/bin/bash
#
# Celery Configuration Pre-Commit Hook
#
# Validates Celery configuration before allowing commits.
# Prevents introduction of technical debt.
#
# Installation:
#   ./scripts/setup-git-hooks.sh
#
# Created: 2025-10-10
# Purpose: Automated Celery configuration enforcement
#

echo "üîç Validating Celery configuration..."

# Run validation script
python scripts/validate_celery_config.py

EXIT_CODE=$?

if [ $EXIT_CODE -eq 0 ]; then
    echo "‚úÖ Celery configuration validation passed"
    exit 0
elif [ $EXIT_CODE -eq 1 ]; then
    echo ""
    echo "‚ùå Celery configuration validation FAILED"
    echo ""
    echo "Critical errors found. Fix before committing:"
    echo "  - Run: python scripts/validate_celery_config.py --report"
    echo "  - Fix all errors listed"
    echo "  - Re-run: git commit"
    echo ""
    exit 1
elif [ $EXIT_CODE -eq 2 ]; then
    echo ""
    echo "‚ö†Ô∏è  Celery configuration has warnings"
    echo ""
    echo "Non-critical issues found. Consider fixing:"
    echo "  - Run: python scripts/validate_celery_config.py --report"
    echo "  - Address warnings for optimal configuration"
    echo ""
    echo "Proceeding with commit (warnings only)..."
    exit 0
else
    echo "‚ö†Ô∏è  Validation script error (code $EXIT_CODE)"
    echo "Proceeding with commit (validation inconclusive)..."
    exit 0
fi
