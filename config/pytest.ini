[pytest]
DJANGO_SETTINGS_MODULE = intelliwiz_config.settings
python_files = test_*.py *_tests.py
testpaths = apps tests
norecursedirs = docs htmlcov .git .tox dist build *.egg __pycache__ migrations

# Test markers
markers =
    unit: Unit tests (fast, isolated)
    integration: Integration tests (moderate speed, database access)
    e2e: End-to-end tests (slow, full system testing)
    performance: Performance benchmark tests
    slow: Slow running tests (>5 seconds)
    requires_selenium: Tests requiring Selenium WebDriver
    requires_db: Tests requiring database access
    ia: Information Architecture migration tests
    heatmap: Tests for heatmap tracking functionality
    ab_testing: Tests for A/B testing functionality
    celery: Tests that involve Celery tasks
    nlp: Tests for NLP engine functionality
    insights: Tests for insights engine functionality
    quality: Tests for quality assurance functionality
    ai_core: Tests for AI core coordination
    security: Security-focused tests for AI components
    api: Tests for API functionality
    rest: Tests for REST API endpoints
    graphql: Tests for GraphQL API
    mobile: Tests for mobile API endpoints
    auth: Tests for authentication functionality
    cache: Tests for caching functionality
    rate_limit: Tests for rate limiting
    monitoring: Tests for API monitoring
    load: Load testing for APIs
    recommendation: Tests for recommendation system functionality
    edge_case: Tests for edge cases and boundary conditions

# Performance test configuration
timeout = 300
timeout_method = thread

# Coverage configuration
addopts = 
    --verbose
    --tb=short
    --strict-markers
    --disable-warnings
    --cov=apps.core.url_router_optimized
    --cov=apps.core.middleware.navigation_tracking
    --cov=apps.core.middleware.ia_tracking
    --cov=apps.core.middleware.recommendation_middleware
    --cov=apps.core.models.heatmap
    --cov=apps.core.models.recommendation
    --cov=apps.core.views.heatmap_views
    --cov=apps.core.views.recommendation_views
    --cov=apps.core.recommendation_engine
    --cov=apps.ab_testing.models
    --cov=apps.ab_testing.analytics
    --cov=apps.nlp_engine
    --cov=apps.insights_engine
    --cov=apps.quality_assurance
    --cov=apps.ai_core
    --cov=apps.api
    --cov-report=term-missing
    --cov-report=html:htmlcov/ai_coverage
    --cov-report=xml:coverage.xml
    --cov-fail-under=85
    --durations=10
    --maxfail=5

# Test discovery
collect_ignore = [
    "setup.py",
    "manage.py",
    "*/migrations/*",
    "staticfiles/*",
    "media/*"
]

# Django test database settings
DJANGO_SETTINGS_MODULE = intelliwiz_config.settings
django_find_project = false

# Logging configuration for tests
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Parallel test execution
# Uncomment to enable parallel testing (requires pytest-xdist)
# addopts = -n auto

# Filter warnings
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore:.*USE_TZ.*:DeprecationWarning
