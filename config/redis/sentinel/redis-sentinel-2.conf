# Redis Sentinel Configuration - Node 2
# High Availability Redis Cluster for IntelliWiz Django Platform
# This configuration provides automatic failover and master discovery

################################## BASIC CONFIGURATION ##################################

# Port for Sentinel to listen on
port 26379

# Sentinel announce IP (set this to the actual IP in production)
sentinel announce-ip ${SENTINEL_2_IP}
sentinel announce-port 26379

# Run as daemon (set to no for Docker/systemd management)
daemonize no

# Process ID file
pidfile /var/run/redis-sentinel-2.pid

# Log file
logfile /var/log/redis/sentinel-2.log

# Log level
loglevel notice

################################## SENTINEL MONITORING ##################################

# Monitor the master Redis instance
# Format: sentinel monitor <master-name> <ip> <port> <quorum>
# Quorum: minimum number of Sentinels that need to agree about master failure
sentinel monitor mymaster ${REDIS_MASTER_IP} ${REDIS_MASTER_PORT} 2

# Authentication for master (if enabled)
sentinel auth-pass mymaster ${REDIS_PASSWORD}

# Master down time before failover (in milliseconds)
# 30 seconds = reasonable for production
sentinel down-after-milliseconds mymaster 30000

# Timeout for failover operation (in milliseconds)
# 3 minutes = allows time for complete failover
sentinel failover-timeout mymaster 180000

# Number of replicas to reconfigure after failover
# 1 = reconfigure one replica at a time for stability
sentinel parallel-syncs mymaster 1

################################## SECURITY ##################################

# Sentinel authentication password
requirepass ${SENTINEL_PASSWORD}

# Bind to specific interfaces (security)
bind 127.0.0.1 ${SENTINEL_2_IP}

# Protected mode
protected-mode yes

################################## NOTIFICATION SCRIPTS ##################################

# Script to execute when master changes (optional)
# sentinel notification-script mymaster /opt/redis/scripts/sentinel-notify.sh

# Script to execute before/after failover (optional)
# sentinel client-reconfig-script mymaster /opt/redis/scripts/sentinel-reconfig.sh

################################## ADVANCED CONFIGURATION ##################################

# Sentinel ID (auto-generated, but can be specified)
# sentinel myid ${SENTINEL_2_ID}

# TCP keepalive
tcp-keepalive 60

# Client timeout
timeout 30

# Memory usage limit for Sentinel
# maxmemory 64mb

################################## MONITORING THRESHOLDS ##################################

# Additional monitoring for different failure conditions

# Master link down time threshold
# sentinel master-reboot-down-after-period mymaster 0

# Replica priority (0 means never promote to master)
# sentinel replica-priority mymaster 100

# Configuration epoch tracking
# sentinel current-epoch 0

################################## LOGGING AND DEBUG ##################################

# Sentinel-specific logging
# sentinel announce-hostnames no
# sentinel resolve-hostnames no

# Deny SCRIPT commands for security
# sentinel deny-scripts-reconfig yes

################################## PERFORMANCE TUNING ##################################

# Connection limits
# maxclients 10000

# Memory optimization for small deployment
hash-max-ziplist-entries 512
hash-max-ziplist-value 64
list-max-ziplist-size -2
set-max-intset-entries 512

################################## CLUSTER INFORMATION ##################################

# This configuration is for a 3-node Sentinel cluster:
#
# Node 1:        ${SENTINEL_1_IP}:26379
# Node 2 (this): ${SENTINEL_2_IP}:26379
# Node 3:        ${SENTINEL_3_IP}:26379
#
# Master Redis:  ${REDIS_MASTER_IP}:${REDIS_MASTER_PORT}
# Replica Redis: ${REDIS_REPLICA_IP}:${REDIS_REPLICA_PORT}
#
# Quorum: 2 (majority of 3 nodes must agree on failover)

################################## DOCKER/CONTAINER SUPPORT ##################################

# For containerized deployments
# dir /data
# save ""

################################## PRODUCTION NOTES ##################################

# 1. Replace environment variables with actual IPs in production
# 2. Ensure firewall allows Sentinel communication on port 26379
# 3. Monitor Sentinel logs for cluster health
# 4. Test failover procedures regularly
# 5. Ensure all Sentinels can reach master and replicas
# 6. Configure notification scripts for operational alerts